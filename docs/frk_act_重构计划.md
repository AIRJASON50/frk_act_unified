# Franka ACT ç³»ç»Ÿé‡æ„è®¡åˆ’

## é¡¹ç›®æ¦‚è¿°

å°†å½“å‰çš„ `frk_act_server` å’Œ `frk_act_client` åˆ†ç¦»æ¶æ„é‡æ„ä¸ºç±»ä¼¼ HIL-SERL çš„ç»Ÿä¸€ä»£ç åº“æ¶æ„ï¼Œå®ç°åŸºäº ACT æ¨¡ä»¿å­¦ä¹ çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚

### æ ¸å¿ƒç›®æ ‡
- **ç»Ÿä¸€ä»£ç åº“**ï¼šæ¶ˆé™¤ server-client é‡å¤ä»£ç ï¼Œå‚è€ƒ SERL æ¶æ„
- **åˆ†å¸ƒå¼éƒ¨ç½²**ï¼šæ”¯æŒè®­ç»ƒæœåŠ¡å™¨å’Œ Franka æ§åˆ¶æœºçš„åˆ†ç¦»éƒ¨ç½²
- **ACT é›†æˆ**ï¼šå°† ACT æ¨¡ä»¿å­¦ä¹ ç®—æ³•é›†æˆåˆ°åˆ†å¸ƒå¼æ¶æ„ä¸­
- **ä»¿çœŸæ¶æ„è°ƒæ•´**ï¼šä½¿ç”¨ Franka å®˜æ–¹çš„ Gazebo ä»¿çœŸå™¨ï¼Œå®¢æˆ·ç«¯è¿è¡Œä»¿çœŸç•Œé¢ï¼ŒæœåŠ¡å™¨å¤„ç†æ•°æ®å’Œæ¨ç†

### å…³é”®æ¶æ„æ¾„æ¸…
**å®¢æˆ·ç«¯æœºå™¨ï¼ˆFrankaæ§åˆ¶æœºï¼‰**ï¼š
- è¿è¡Œ Franka Gazebo ä»¿çœŸå‰ç«¯ç•Œé¢
- æ˜¾ç¤º Gazebo ä»¿çœŸç”»é¢å’Œ RViz å¯è§†åŒ–
- é€šè¿‡ ROS æ¥å£é‡‡é›†æœºå™¨äººçŠ¶æ€ã€å…³èŠ‚ä¿¡æ¯ã€ç›¸æœºå›¾åƒ
- å‘é€è§‚æµ‹æ•°æ®åˆ°æœåŠ¡å™¨ï¼Œæ¥æ”¶ ACT ç­–ç•¥æ§åˆ¶æŒ‡ä»¤
- é€šè¿‡ ROS æ§åˆ¶æ¥å£æ‰§è¡ŒåŠ¨ä½œå‘½ä»¤

**æœåŠ¡å™¨æœºå™¨ï¼ˆGPUè®­ç»ƒæœºï¼‰**ï¼š
- æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„ä»¿çœŸè§‚æµ‹æ•°æ®
- æ‰§è¡Œ ACT æ¨¡å‹æ¨ç†å’Œè®­ç»ƒ
- å­˜å‚¨è®­ç»ƒæ•°æ®å’Œæ¨¡å‹
- è¿”å›å…³èŠ‚ä½ç½®/é€Ÿåº¦/åŠ›çŸ©æ§åˆ¶æŒ‡ä»¤ç»™å®¢æˆ·ç«¯

## é‡æ„ç­–ç•¥

### ç¬¬ä¸€é˜¶æ®µï¼šæ¶æ„é‡ç»„ï¼ˆä¼˜å…ˆå¤åˆ¶ä¿®æ”¹ vs é‡å†™ï¼‰

#### 1.1 SERL æ ¸å¿ƒæ¶æ„å¤ç”¨ï¼ˆçº¯ Python ç”Ÿæ€ï¼‰
```
å®Œå…¨åŸºäº SERL æˆç†Ÿçš„ Python ç”Ÿæ€ç³»ç»Ÿï¼š

ä» hil-serl/serl_robot_infra/ å¤ç”¨ï¼š
â”œâ”€â”€ robot_servers/franka_server.py  # Flask HTTP æœåŠ¡å™¨ï¼ˆå®Œæ•´å¤ç”¨ï¼‰
â”‚   # å¤„ç†æ‰€æœ‰ Python â†” ROS é€šä¿¡
â”‚   # æä¾›ç»Ÿä¸€çš„ HTTP API æ¥å£
â”‚   # å°è£…æœºå™¨äººçŠ¶æ€æŸ¥è¯¢å’Œæ§åˆ¶å‘½ä»¤

ä» hil-serl/serl_robot_infra/franka_env/ å‚è€ƒï¼š
â”œâ”€â”€ franka_env.py                   # ç¯å¢ƒæ¶æ„å‚è€ƒ
â”‚   # é€‚é… ACT è§‚æµ‹ç©ºé—´ï¼ˆqpos + imagesï¼‰
â”‚   # é€‚é… ACT åŠ¨ä½œç©ºé—´ï¼ˆ7Då…³èŠ‚ + 1Då¤¹çˆªï¼‰
â”‚   # HTTP å®¢æˆ·ç«¯æ¨¡å¼è¿æ¥ Flask æœåŠ¡å™¨

ä» hil-serl/examples/ å‚è€ƒï¼š
â”œâ”€â”€ train_rlpd.py                  # æ¶æ„å‚è€ƒ â†’ train_act_distributed.py
â”‚   # åˆ†å¸ƒå¼è®­ç»ƒä¸»å¾ªç¯
â”‚   # AgentLace å®¢æˆ·ç«¯/æœåŠ¡å™¨é›†æˆ
â”‚   # RL è®­ç»ƒæ›¿æ¢ä¸º ACT æ¨¡ä»¿å­¦ä¹ 
```

#### 1.2 Franka ROS ç³»ç»Ÿé›†æˆï¼ˆGit å­æ¨¡å— + Flask æ¡¥æ¥ï¼‰
```
å®Œæ•´é›†æˆ franka_ros ä½œä¸º Git å­æ¨¡å—ï¼š
â”œâ”€â”€ franka_ros/                     # Git Submodule (å®Œæ•´å®˜æ–¹åŒ…)
â”‚   â”œâ”€â”€ franka_gazebo/             # Gazebo ä»¿çœŸåŒ…
â”‚   â”œâ”€â”€ franka_control/            # æœºå™¨äººæ§åˆ¶åŒ…
â”‚   â”œâ”€â”€ franka_description/        # URDF æè¿°æ–‡ä»¶
â”‚   â”œâ”€â”€ franka_gripper/            # å¤¹çˆªæ§åˆ¶åŒ…
â”‚   â”œâ”€â”€ franka_hw/                 # ç¡¬ä»¶æŠ½è±¡å±‚
â”‚   â””â”€â”€ franka_msgs/               # ROS æ¶ˆæ¯å®šä¹‰

SERL Flask HTTP æ¡¥æ¥ç­–ç•¥ï¼š
âœ… å¤ç”¨ SERL æˆç†Ÿçš„ Flask æœåŠ¡å™¨æ¶æ„
âœ… Python HTTP å®¢æˆ·ç«¯ â†” Flask æœåŠ¡å™¨ â†” ROS ç³»ç»Ÿ
âœ… æ— éœ€å¼€å‘ ROS-ZeroMQ æ¡¥æ¥å±‚
âœ… å®Œå…¨åŸºäº Python ç”Ÿæ€ç³»ç»Ÿ

é€šä¿¡æµç¨‹ï¼š
ACT Python ç¯å¢ƒ â†’ HTTP è¯·æ±‚ â†’ Flask æœåŠ¡å™¨ â†’ ROS Topics
                â† HTTP å“åº” â† Flask æœåŠ¡å™¨ â† ROS Topics

ä¼˜åŠ¿ï¼š
- ğŸ çº¯ Python å¼€å‘ä½“éªŒ
- ğŸ”„ å¤ç”¨ SERL æˆç†Ÿæ¶æ„
- ğŸš€ å¼€ç®±å³ç”¨çš„æœºå™¨äººæ§åˆ¶
- ğŸ›¡ï¸ Flask æœåŠ¡å™¨å¤„ç†æ‰€æœ‰ ROS å¤æ‚æ€§
```

#### 1.3 AgentLace åˆ†å¸ƒå¼æ¡†æ¶é›†æˆ
```
å®Œæ•´å¤ç”¨ AgentLace åˆ†å¸ƒå¼è®­ç»ƒæ¡†æ¶ï¼š
â”œâ”€â”€ agentlace/
â”‚   â”œâ”€â”€ trainer.py                  # TrainerServer/Clientï¼ˆå®Œæ•´å¤ç”¨ï¼‰
â”‚   â”‚   # å¤„ç†åˆ†å¸ƒå¼è®­ç»ƒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯é€šä¿¡
â”‚   â”‚   # æ”¯æŒå¤šå®¢æˆ·ç«¯è¿æ¥å’Œè´Ÿè½½å‡è¡¡
â”‚   â”‚   # ç½‘ç»œå‚æ•°åŒæ­¥å’Œæ•°æ®æ”¶é›†
â”‚   â”œâ”€â”€ data/data_store.py          # æ•°æ®ä¼ è¾“åè®®ï¼ˆé€‚é… ACTï¼‰
â”‚   â”‚   # åŸï¼šRL transitions (s, a, r, s')
â”‚   â”‚   # æ–°ï¼šACT demonstrations (obs, actions)
â”‚   â””â”€â”€ zmq_wrapper/                # ZeroMQ é€šè®¯ï¼ˆä¿æŒä¸å˜ï¼‰
â”‚       # é«˜æ€§èƒ½åˆ†å¸ƒå¼é€šä¿¡
â”‚       # æ”¯æŒ TCP/IPC å¤šç§åè®®

é›†æˆç­–ç•¥ï¼š
âœ… ä¿æŒ AgentLace æ ¸å¿ƒæ¶æ„ä¸å˜
âœ… ä¿®æ”¹æ•°æ®æ ¼å¼æ”¯æŒ ACT è®­ç»ƒæ•°æ®
âœ… TrainerServer å¤„ç†æ¨¡å‹è®­ç»ƒå’Œå‚æ•°åˆ†å‘
âœ… TrainerClient å¤„ç†æ•°æ®æ”¶é›†å’ŒåŠ¨ä½œæŸ¥è¯¢
```

### ç¬¬äºŒé˜¶æ®µï¼šACT ç®—æ³•é›†æˆ



#### 2.2 å®Œæ•´ç³»ç»Ÿæ¶æ„å›¾ï¼ˆSERL + ACT é›†æˆï¼‰
```
ğŸ–¥ï¸  GPU è®­ç»ƒæœåŠ¡å™¨                 ğŸ“± Franka æ§åˆ¶æœºï¼ˆå®¢æˆ·ç«¯ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ACT è®­ç»ƒæœåŠ¡å™¨        â”‚       â”‚   ACT ç¯å¢ƒé€‚é…å™¨        â”‚
â”‚  - åŸç‰ˆ ACT ç®—æ³•        â”‚â—„â”€â”€â”€â”€â”€â”€â”¤  - franka_act_env.py   â”‚
â”‚  - æ¨¡ä»¿å­¦ä¹ è®­ç»ƒ          â”‚ Agent â”‚  - HTTP å®¢æˆ·ç«¯æ¨¡å¼      â”‚
â”‚  - æ¨¡å‹å‚æ•°åˆ†å‘          â”‚ Lace  â”‚  - è§‚æµ‹ï¼šqpos+images   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  - åŠ¨ä½œï¼š7Då…³èŠ‚+1Då¤¹çˆª   â”‚
           â–²                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ ZeroMQ                           â”‚ HTTP API
           â”‚ (æ¨¡å‹åŒæ­¥)                        â–¼
           â–¼                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   SERL Flask æœåŠ¡å™¨     â”‚
â”‚   AgentLace æ¡†æ¶        â”‚       â”‚  - Python â†” ROS æ¡¥æ¥  â”‚
â”‚  - TrainerServer       â”‚       â”‚  - æœºå™¨äººçŠ¶æ€æŸ¥è¯¢       â”‚
â”‚  - åˆ†å¸ƒå¼åè°ƒ           â”‚       â”‚  - æ§åˆ¶å‘½ä»¤æ‰§è¡Œ         â”‚
â”‚  - æ•°æ®æ”¶é›†ç®¡ç†         â”‚       â”‚  - ç›¸æœºæ•°æ®è·å–         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚ ROS Topics
                                             â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚     å®Œæ•´ franka_ros      â”‚
                                  â”‚  - franka_gazebo       â”‚
                                  â”‚  - franka_control      â”‚
                                  â”‚  - franka_gripper      â”‚
                                  â”‚  - ç›¸æœºé©±åŠ¨             â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”‘ æ ¸å¿ƒä¼˜åŠ¿ï¼š
âœ… çº¯ Python å¼€å‘ä½“éªŒï¼ˆFlask + HTTP + AgentLaceï¼‰
âœ… é›¶ ROS å¼€å‘å¤æ‚åº¦ï¼ˆFlask æœåŠ¡å™¨å°è£…æ‰€æœ‰ ROS ç»†èŠ‚ï¼‰
âœ… æˆç†Ÿåˆ†å¸ƒå¼æ¶æ„ï¼ˆAgentLace å¤„ç†ç½‘ç»œé€šä¿¡ï¼‰
âœ… åŸç‰ˆ ACT ç®—æ³•ï¼ˆä¿è¯æ¨¡å‹æ€§èƒ½ï¼‰
## ç›®æ ‡ï¼šåŸºäºåŸç‰ˆ ACT + Flask HTTP é€šä¿¡æ¶æ„çš„åˆ†å¸ƒå¼ç³»ç»Ÿ

### æ ¸å¿ƒç­–ç•¥ï¼šSERL æ¶æ„ + åŸç‰ˆ ACT ç®—æ³• + franka_ros å®Œæ•´é›†æˆ
ä»é›¶å¼€å§‹æ„å»ºï¼Œä½¿ç”¨åŸç‰ˆ ACT ç®—æ³•ï¼Œå¤ç”¨ SERL çš„ Flask HTTP æœåŠ¡å™¨å’Œ AgentLace åˆ†å¸ƒå¼æ¶æ„ï¼Œé›†æˆå®Œæ•´çš„ franka_ros ä»“åº“ï¼Œæ„å»ºå…¨æ–°çš„åˆ†å¸ƒå¼ Franka ACT è®­ç»ƒç³»ç»Ÿã€‚

**é‡è¦è¯´æ˜ï¼š**
- ğŸš« ä¸å‚è€ƒç°æœ‰ `/home/wujielin/CascadeProjects/projects/ws/frk_act` å†…å®¹
- âœ… ä½¿ç”¨åŸç‰ˆ ACT ç®—æ³•è¿›è¡Œå…¨æ–°å¼€å‘ 
- âœ… franka_ros ä½œä¸ºå®Œæ•´ Git å­æ¨¡å—é›†æˆ
- âœ… ä»¿çœŸä½¿ç”¨ Franka Gazeboï¼Œä¸å¤ç”¨ SERL ä»¿çœŸé¡¹ç›®

## ä¸€ã€æºä»£ç é›†æˆè·¯å¾„ï¼ˆæ˜ç¡®å¤ç”¨æ¥æºï¼‰

### 1.1 æºä»£ç è·¯å¾„æ˜ å°„
```
æºä»£ç æ¥æºè·¯å¾„                                    â†’ ç›®æ ‡é›†æˆè·¯å¾„
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
åŸç‰ˆ ACT ç®—æ³•:
/home/wujielin/CascadeProjects/projects/openSource/ç¤ºæ•™å­¦ä¹ /act/aloha/act/
â”œâ”€â”€ policy.py                               â†’ act_algo/policy.py
â”œâ”€â”€ detr/                                   â†’ act_algo/detr/ 
â”œâ”€â”€ imitate_episodes.py                     â†’ act_algo/imitate_episodes.py
â””â”€â”€ utils.py                                â†’ act_algo/utils.py

SERL æ¶æ„å¤ç”¨:
/home/wujielin/CascadeProjects/projects/openSource/serl/hil-serl/
â”œâ”€â”€ serl_robot_infra/robot_servers/franka_server.py â†’ robot_servers/franka_server.py
â”œâ”€â”€ serl_robot_infra/franka_env/             â†’ robot_env/ (æ¶æ„å‚è€ƒï¼Œé‡æ–°å®ç°)
â””â”€â”€ examples/train_rlpd.py                  â†’ train_act_distributed.py (æ¶æ„å‚è€ƒ)

AgentLace åˆ†å¸ƒå¼æ¡†æ¶:
/home/wujielin/CascadeProjects/projects/openSource/serl/agentlace/ 
â†’ agentlace/ (å®Œæ•´å¤ç”¨)

Franka ROS å®Œæ•´é›†æˆ:
https://github.com/frankaemika/franka_ros.git â†’ franka_ros/ (Git å­æ¨¡å—)
```

## äºŒã€æ ¸å¿ƒæ¶æ„è®¾è®¡ï¼ˆFlask + AgentLace + åŸç‰ˆ ACTï¼‰

### 2.1 å®Œæ•´é€šä¿¡æ¶æ„
```
è®­ç»ƒæœåŠ¡å™¨ (GPU)          â”‚  å®¢æˆ·ç«¯ (Franka æ§åˆ¶æœº)
                         â”‚ 
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŸç‰ˆ ACT è®­ç»ƒæœåŠ¡å™¨  â”‚   â”‚  â”‚    ACT ç¯å¢ƒé€‚é…å™¨       â”‚
â”‚  - ACT Policy ç½‘ç»œ   â”‚   â”‚  â”‚  - franka_act_env.py   â”‚
â”‚  - æ¨¡ä»¿å­¦ä¹ ç®—æ³•      â”‚â—„â”€â”€â”¼â”€â”€â”¤  - è§‚æµ‹ï¼šqpos + images  â”‚
â”‚  - imitate_episodes â”‚   â”‚  â”‚  - åŠ¨ä½œï¼š7Då…³èŠ‚+1Då¤¹çˆª  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²               â”‚                â”‚
         â”‚ AgentLace     â”‚                â”‚ HTTP
         â”‚ (ZeroMQ)      â”‚                â–¼
         â”‚               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚               â”‚  â”‚   SERL Flask æœåŠ¡å™¨     â”‚
         â”‚               â”‚  â”‚  - Python â†” ROS ç¼–è§£ç  â”‚
         â”‚               â”‚  â”‚  - æœºå™¨äººçŠ¶æ€æŸ¥è¯¢        â”‚
         â”‚               â”‚  â”‚  - æ§åˆ¶å‘½ä»¤å‘å¸ƒ          â”‚
         â”‚               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚               â”‚                â”‚
         â”‚               â”‚                â”‚ ROS Topics  
         â”‚               â”‚                â–¼
         â”‚               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚               â”‚  â”‚   å®Œæ•´ franka_ros       â”‚
         â”‚               â”‚  â”‚  - franka_gazebo        â”‚
         â”‚               â”‚  â”‚  - franka_control       â”‚
         â”‚               â”‚  â”‚  - franka_gripper       â”‚
         â”‚               â”‚  â”‚  - franka_description   â”‚
         â”‚               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.1 å…¨æ–°é¡¹ç›®ç»“æ„ï¼ˆä»é›¶æ„å»ºï¼‰
```
frk_act_unified/                    # å…¨æ–°é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ act_algo/                       # åŸç‰ˆ ACT ç®—æ³•ï¼ˆä»ç¤ºæ•™å­¦ä¹ /actå¤åˆ¶ï¼‰
â”‚   â”œâ”€â”€ policy.py                  # ACTç­–ç•¥ç½‘ç»œ
â”‚   â”œâ”€â”€ detr/                      # DETRç½‘ç»œå®ç°
â”‚   â”œâ”€â”€ imitate_episodes.py        # æ¨¡ä»¿å­¦ä¹ è®­ç»ƒ
â”‚   â””â”€â”€ utils.py                   # ACTå·¥å…·å‡½æ•°
â”‚
â”œâ”€â”€ robot_servers/                  # SERL FlaskæœåŠ¡å™¨ï¼ˆå¤ç”¨ï¼‰
â”‚   â””â”€â”€ franka_server.py           # HTTP-ROSæ¡¥æ¥æœåŠ¡å™¨
â”‚
â”œâ”€â”€ robot_env/                      # æœºå™¨äººç¯å¢ƒï¼ˆé‡æ–°å®ç°ï¼Œé€‚é…ACTï¼‰
â”‚   â””â”€â”€ franka_act_env.py          # ACTä¸“ç”¨ç¯å¢ƒæ¥å£
â”‚
â”œâ”€â”€ agentlace/                      # åˆ†å¸ƒå¼è®­ç»ƒæ¡†æ¶ï¼ˆå®Œæ•´å¤ç”¨ï¼‰
â”‚   â”œâ”€â”€ trainer.py                 # TrainerServer/Client
â”‚   â””â”€â”€ data/                      # æ•°æ®ä¼ è¾“åè®®
â”‚
â”œâ”€â”€ franka_ros/                     # å®Œæ•´franka_rosï¼ˆGitå­æ¨¡å—ï¼‰
â”‚   â”œâ”€â”€ franka_gazebo/             # Gazeboä»¿çœŸ
â”‚   â”œâ”€â”€ franka_control/            # æœºå™¨äººæ§åˆ¶
â”‚   â”œâ”€â”€ franka_gripper/            # å¤¹çˆªæ§åˆ¶
â”‚   â”œâ”€â”€ franka_description/        # URDFæ¨¡å‹
â”‚   â””â”€â”€ franka_msgs/               # ROSæ¶ˆæ¯å®šä¹‰
â”‚
â”œâ”€â”€ scripts/                        # å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ start_franka_client.sh     # å®¢æˆ·ç«¯å¯åŠ¨
â”‚   â”œâ”€â”€ start_act_server.sh        # æœåŠ¡å™¨å¯åŠ¨
â”‚   â””â”€â”€ setup_project.sh           # é¡¹ç›®åˆå§‹åŒ–
â”‚
â”œâ”€â”€ configs/                        # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ act_config.yaml            # ACTè¶…å‚æ•°
â”‚   â””â”€â”€ robot_config.yaml          # æœºå™¨äººé…ç½®
â”‚
â”œâ”€â”€ train_act_distributed.py        # ä¸»è®­ç»ƒè„šæœ¬
â”œâ”€â”€ requirements.txt                # Pythonä¾èµ–
â””â”€â”€ README.md                       # é¡¹ç›®æ–‡æ¡£
### 3.2 Git å­æ¨¡å—å’Œæºä»£ç é›†æˆ
```bash
# åˆ›å»ºå…¨æ–°é¡¹ç›®ç›®å½•
mkdir -p /home/wujielin/CascadeProjects/projects/ws/
cd /home/wujielin/CascadeProjects/projects/ws/
git init

# æ·»åŠ  franka_ros ä½œä¸ºå®Œæ•´çš„ Git å­æ¨¡å—
git submodule add https://github.com/frankaemika/franka_ros.git franka_ros
git submodule update --init --recursive

# å¤åˆ¶åŸç‰ˆ ACT ç®—æ³•æºä»£ç 
cp -r /home/wujielin/CascadeProjects/projects/openSource/ç¤ºæ•™å­¦ä¹ /act/aloha/act/* act_algo/

# å¤åˆ¶ SERL Flask æœåŠ¡å™¨
cp /home/wujielin/CascadeProjects/projects/openSource/serl/hil-serl/serl_robot_infra/robot_servers/franka_server.py robot_servers/

# å¤åˆ¶ AgentLace åˆ†å¸ƒå¼æ¡†æ¶
cp -r /home/wujielin/CascadeProjects/projects/openSource/serl/agentlace/ ./

# åˆ›å»ºå…¶ä»–å¿…éœ€ç›®å½•
mkdir -p robot_env scripts configs
```

## å››ã€ç³»ç»Ÿå¯åŠ¨æµç¨‹ï¼ˆåŸç‰ˆ ACT + Flaskï¼‰

### 4.1 å®¢æˆ·ç«¯å¯åŠ¨è„šæœ¬ï¼ˆFranka æ§åˆ¶æœºï¼‰
```
```bash
#!/bin/bash
# scripts/start_franka_client.sh

SERVER_IP=${1:-"10.16.49.124"}  # æœåŠ¡å™¨IP
ROBOT_IP=${2:-"172.16.0.2"}    # æœºå™¨äººIP
MODE=${3:-"sim"}               # sim æˆ– real

echo "å¯åŠ¨ Franka ACT å®¢æˆ·ç«¯..."
echo "è®­ç»ƒæœåŠ¡å™¨: $SERVER_IP"
echo "æœºå™¨äººæ¨¡å¼: $MODE"

# ç¬¬1æ­¥ï¼šå¯åŠ¨ ROS ç³»ç»Ÿ
echo "[1/3] å¯åŠ¨ ROS ç³»ç»Ÿ..."
roscore &
sleep 2

if [ "$MODE" = "sim" ]; then
    # å¯åŠ¨ Franka Gazebo ä»¿çœŸï¼ˆä½¿ç”¨å®Œæ•´ franka_rosï¼‰
    echo "å¯åŠ¨ Franka Gazebo ä»¿çœŸ..."
    roslaunch franka_gazebo panda_arm.launch \
        gazebo:=true headless:=false \
        use_gripper:=true \
        controller:=cartesian_impedance_example_controller &
    sleep 10
else
    # å¯åŠ¨çœŸæœºæ§åˆ¶ï¼ˆä½¿ç”¨ franka_ros æ§åˆ¶å™¨ï¼‰
    echo "å¯åŠ¨ Franka çœŸæœºæ§åˆ¶..."
    roslaunch franka_control franka_control.launch \
        robot_ip:=$ROBOT_IP load_gripper:=true &
    sleep 5
fi

# ç¬¬2æ­¥ï¼šå¯åŠ¨ Flask HTTP æœåŠ¡å™¨ï¼ˆå¤ç”¨ SERLï¼‰
echo "[2/3] å¯åŠ¨ Flask æœºå™¨äººæœåŠ¡å™¨..."
python robot_servers/franka_server.py \
    --robot_ip $ROBOT_IP \
    --gripper_type Franka &
sleep 3

# ç¬¬3æ­¥ï¼šå¯åŠ¨ ACT å®¢æˆ·ç«¯ç¯å¢ƒï¼ˆåŸç‰ˆç®—æ³•é€‚é…ï¼‰
echo "[3/3] å¯åŠ¨ ACT å®¢æˆ·ç«¯ç¯å¢ƒ..."
python train_act_distributed.py \
    --client \
    --server_ip $SERVER_IP \
    --task franka_cube_transfer \
    --act_config configs/act_config.yaml

echo "âœ… Franka ACT å®¢æˆ·ç«¯å¯åŠ¨å®Œæˆ"
```


## ä¸‰ã€è¯¦ç»†å®æ–½æ­¥éª¤

### é˜¶æ®µ 1ï¼šç¯å¢ƒé€‚é…å™¨å®ç° (1-2 å¤©)

#### æ­¥éª¤ 1.1ï¼šåˆ›å»º ACT ç¯å¢ƒé€‚é…å™¨
```python
# robot_env/franka_act_env.py
# åŸºäº SERL franka_env.py æ¶æ„ï¼Œé€‚é…åŸç‰ˆ ACT
class FrankaACTEnv(gym.Env):
    """Franka ACT ç¯å¢ƒï¼Œä½¿ç”¨ SERL Flask HTTP é€šä¿¡"""
    def __init__(self, server_url="http://127.0.0.1:5000/"):
        # HTTP å®¢æˆ·ç«¯è¿æ¥åˆ° Flask æœåŠ¡å™¨
        # ACT ä¸“ç”¨è§‚æµ‹ç©ºé—´å’ŒåŠ¨ä½œç©ºé—´å®šä¹‰
        # å¤ç”¨ SERL çš„æœºå™¨äººçŠ¶æ€æŸ¥è¯¢å’Œæ§åˆ¶æ¥å£
```

#### æ­¥éª¤ 1.2ï¼šé€‚é… ACT æ•°æ®æ ¼å¼
```python
# è§‚æµ‹ç©ºé—´é€‚é…
obs_space = spaces.Dict({
    'qpos': spaces.Box(shape=(7,)),      # å…³èŠ‚ä½ç½®
    'qvel': spaces.Box(shape=(7,)),      # å…³èŠ‚é€Ÿåº¦  
    'images': spaces.Dict({              # å¤šç›¸æœºå›¾åƒ
        'cam_high': spaces.Box(shape=(480,640,3)),
        'cam_low': spaces.Box(shape=(480,640,3))
    })
})

# åŠ¨ä½œç©ºé—´é€‚é… 
action_space = spaces.Box(shape=(8,))    # 7Då…³èŠ‚ + 1Då¤¹çˆª
```

### é˜¶æ®µ 2ï¼šåˆ†å¸ƒå¼è®­ç»ƒé›†æˆ (2-3 å¤©)

#### æ­¥éª¤ 2.1ï¼šAgentLace æ•°æ®æ ¼å¼é€‚é…
```python
# agentlace æ•°æ®æ ¼å¼ä¿®æ”¹ï¼ˆä» RL åˆ°æ¨¡ä»¿å­¦ä¹ ï¼‰

# åŸ SERL æ•°æ®æ ¼å¼ï¼ˆRLï¼‰:
rl_transition = {
    'observation': obs,
    'action': action, 
    'reward': reward,
    'next_observation': next_obs,
    'done': done
}

# æ–° ACT æ•°æ®æ ¼å¼ï¼ˆæ¨¡ä»¿å­¦ä¹ ï¼‰:
act_demonstration = {
    'observations': obs_sequence,     # è§‚æµ‹åºåˆ—
    'actions': action_sequence,      # åŠ¨ä½œåºåˆ—
    'episode_id': episode_id,       # è½¨è¿¹æ ‡è¯†
    'timestep': timestep            # æ—¶é—´æ­¥
}
```

#### æ­¥éª¤ 2.2ï¼šè®­ç»ƒæœåŠ¡å™¨å®ç°
```python
# train_act_distributed.pyï¼ˆä¸»è®­ç»ƒè„šæœ¬ï¼‰
def run_training_server():
    # åˆå§‹åŒ–åŸç‰ˆ ACT ç­–ç•¥ç½‘ç»œ
    policy = ACTPolicy(act_config)
    
    # AgentLace è®­ç»ƒæœåŠ¡å™¨
    server = TrainerServer(trainer_config)
    
    # ACT æ¨¡ä»¿å­¦ä¹ è®­ç»ƒå¾ªç¯
    for epoch in range(num_epochs):
        batch = get_demonstration_batch()
        loss = act_loss_function(policy, batch)
        policy = update_policy(policy, loss)
        server.publish_policy(policy)
```

### é˜¶æ®µ 3ï¼šç«¯åˆ°ç«¯é›†æˆæµ‹è¯• (2-3 å¤©)

#### æ­¥éª¤ 3.1ï¼šå¯åŠ¨è„šæœ¬åˆ›å»º
```bash
# æœåŠ¡å™¨å¯åŠ¨ï¼ˆGPU è®­ç»ƒæœºï¼‰
./scripts/start_act_server.sh

# å®¢æˆ·ç«¯å¯åŠ¨ï¼ˆFranka æ§åˆ¶æœºï¼‰  
./scripts/start_franka_client.sh [server_ip] [robot_ip] [sim|real]
```

#### æ­¥éª¤ 3.2ï¼šä»¿çœŸç¯å¢ƒéªŒè¯
- å¯åŠ¨ Franka Gazebo ä»¿çœŸ
- æµ‹è¯• Flask æœåŠ¡å™¨è¿æ¥
- éªŒè¯ ACT ç¯å¢ƒæ•°æ®æµ
- æµ‹è¯•åˆ†å¸ƒå¼è®­ç»ƒé€šä¿¡

#### æ­¥éª¤ 3.3ï¼šçœŸæœºç¯å¢ƒéƒ¨ç½²
- çœŸæœº Flask æœåŠ¡å™¨é…ç½®
- ç½‘ç»œè¿æ¥æµ‹è¯•
- å®‰å…¨æµ‹è¯•å’Œæ•…éšœå¤„ç†

#### æ­¥éª¤ 3.1ï¼šACT ç­–ç•¥ç½‘ç»œé›†æˆ
**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `frk_act/agents/act_agent.py` â†’ é›†æˆç°æœ‰çš„ ACT ç­–ç•¥ç½‘ç»œ
- `frk_act/models/policy.py` â†’ æ•´åˆ ACT æ¨¡å‹å®šä¹‰

#### æ­¥éª¤ 3.2ï¼šè®­ç»ƒé€»è¾‘æ”¹é€ 
**é‡ç‚¹ä¿®æ”¹ï¼š**
- `train_act_distributed.py` â†’ å°† SERL çš„ RL è®­ç»ƒæ”¹ä¸º ACT çš„æ¨¡ä»¿å­¦ä¹ 
- `frk_act/training/act_trainer.py` â†’ å®ç° ACT ç‰¹å®šçš„è®­ç»ƒé€»è¾‘

### é˜¶æ®µ 4ï¼šç¯å¢ƒé€‚é…å’Œæµ‹è¯• (2-3 å¤©)

#### æ­¥éª¤ 4.1ï¼šFranka ç¯å¢ƒé€‚é…
**ä¿®æ”¹é‡ç‚¹ï¼š**
- `frk_act/environments/franka_env.py` â†’ é€‚é…å•è‡‚ Franka (åŸ ACT ä¸ºåŒè‡‚)
- å°†åŒè‡‚ååŒæ“ä½œæ”¹ä¸ºå•è‡‚ç²¾ç»†æ“ä½œ

#### æ­¥éª¤ 4.2ï¼šä»¿çœŸç¯å¢ƒé›†æˆ
- é›†æˆç°æœ‰çš„ä»¿çœŸç¯å¢ƒåˆ°ç»Ÿä¸€æ¶æ„ä¸­
- ç¡®ä¿ä»¿çœŸå’ŒçœŸå®ç¯å¢ƒæ¥å£ä¸€è‡´

### é˜¶æ®µ 5ï¼šé›†æˆæµ‹è¯•å’Œä¼˜åŒ– (2-3 å¤©)

#### æ­¥éª¤ 5.1ï¼šåˆ†å¸ƒå¼éƒ¨ç½²æµ‹è¯•
```bash
# æœåŠ¡å™¨ç«¯å¯åŠ¨è®­ç»ƒ
python train_act_distributed.py --server --ip 0.0.0.0 --task sim_transfer_cube

# å®¢æˆ·ç«¯è¿æ¥
python train_act_distributed.py --client --ip 10.16.49.124 --task sim_transfer_cube
```

#### æ­¥éª¤ 5.2ï¼šæ•°æ®æµéªŒè¯
- éªŒè¯æ•°æ®æ”¶é›† â†’ ä¸Šä¼  â†’ è®­ç»ƒ â†’ æ¨¡å‹åˆ†å‘çš„å®Œæ•´æµç¨‹
- ç¡®ä¿ç½‘ç»œé€šè®¯ç¨³å®šæ€§å’Œæ•°æ®ä¸€è‡´æ€§

## å…³é”®ä¿®æ”¹ç‚¹æ€»ç»“

### é«˜ä¼˜å…ˆçº§ä¿®æ”¹ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
1. **train_rlpd.py â†’ train_act_distributed.py**
   - å°†å¼ºåŒ–å­¦ä¹ æ”¹ä¸ºæ¨¡ä»¿å­¦ä¹ 
   - ä¿®æ”¹ actor/learner é€»è¾‘ä¸º client/server é€»è¾‘

2. **æ•°æ®æ ¼å¼é€‚é…**
   - SERL: (state, action, reward, next_state)
   - ACT: (observation, action) ç¤ºèŒƒå¯¹

3. **ç½‘ç»œæ¶æ„å·®å¼‚**
   - SERL: SAC ç½‘ç»œ
   - ACT: Transformer + DETR ç½‘ç»œ

### ä¸­ä¼˜å…ˆçº§ä¿®æ”¹ï¼ˆæ¶æ„æ•´åˆï¼‰
1. **ç¯å¢ƒæ¥å£ç»Ÿä¸€**
   - ç»Ÿä¸€ä»¿çœŸå’ŒçœŸå®ç¯å¢ƒçš„æ¥å£
   - é€‚é… Franka å•è‡‚æ“ä½œ

2. **é…ç½®ç®¡ç†æ•´åˆ**
   - åˆå¹¶ server/client çš„é…ç½®æ–‡ä»¶
   - ç»Ÿä¸€ä»»åŠ¡å®šä¹‰å’Œå‚æ•°

### ä½ä¼˜å…ˆçº§ä¿®æ”¹ï¼ˆä¼˜åŒ–åŠŸèƒ½ï¼‰
1. **æ—¥å¿—å’Œç›‘æ§**
2. **é”™è¯¯å¤„ç†å’Œæ¢å¤**
3. **æ€§èƒ½ä¼˜åŒ–**

## é¢„æœŸæˆæœ

### éƒ¨ç½²æ–¹å¼
1. **å¼€å‘é˜¶æ®µ**ï¼šæœ¬åœ°å•æœºæ¨¡å¼ï¼Œå¿«é€Ÿè°ƒè¯•
2. **æµ‹è¯•é˜¶æ®µ**ï¼šåˆ†å¸ƒå¼æ¨¡å¼ï¼ŒéªŒè¯é€šè®¯
3. **ç”Ÿäº§é˜¶æ®µ**ï¼šæœåŠ¡å™¨è®­ç»ƒ + Franka æ§åˆ¶æœºæ¨ç†

### æ–‡ä»¶ç»„ç»‡ä¼˜åŠ¿
- æ¶ˆé™¤ä»£ç é‡å¤ï¼Œç»Ÿä¸€ç»´æŠ¤
- é€šè®¯åè®®è‡ªåŠ¨åŒæ­¥
- ç®€åŒ–éƒ¨ç½²å’Œé…ç½®ç®¡ç†
- ä¾¿äºåŠŸèƒ½æ‰©å±•å’Œè°ƒè¯•

## é£é™©è¯„ä¼°ä¸åº”å¯¹

### ä¸»è¦é£é™©
1. **é€šè®¯åè®®é€‚é…å¤æ‚åº¦**
   - åº”å¯¹ï¼šå…ˆå®ç°åŸºç¡€åŠŸèƒ½ï¼Œé€æ­¥å®Œå–„
2. **ACT ç®—æ³•é›†æˆéš¾åº¦**
   - åº”å¯¹ï¼šä¿æŒç°æœ‰ ACT å®ç°ï¼Œä»…åšæ¥å£é€‚é…
3. **åˆ†å¸ƒå¼è°ƒè¯•å›°éš¾**
   - åº”å¯¹ï¼šä¼˜å…ˆå®Œæˆæœ¬åœ°æ¨¡å¼ï¼Œå†æµ‹è¯•åˆ†å¸ƒå¼

### å›é€€ç­–ç•¥
- ä¿ç•™åŸæœ‰ frk_act_server/client ä»£ç ä½œä¸ºå¤‡ä»½
- åˆ†é˜¶æ®µéªŒè¯ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½æœ‰å¯è¿è¡Œçš„ç‰ˆæœ¬

## æ—¶é—´è§„åˆ’
- **æ€»è®¡**ï¼š10-15 å¤©
- **é‡Œç¨‹ç¢‘ 1**ï¼šç»Ÿä¸€æ¶æ„æ­å»ºå®Œæˆ (3 å¤©)
- **é‡Œç¨‹ç¢‘ 2**ï¼šé€šè®¯æ¡†æ¶æ­£å¸¸å·¥ä½œ (6 å¤©)
- **é‡Œç¨‹ç¢‘ 3**ï¼šACT ç®—æ³•å®Œæ•´é›†æˆ (10 å¤©)
- **é‡Œç¨‹ç¢‘ 4**ï¼šåˆ†å¸ƒå¼éƒ¨ç½²éªŒè¯ (15 å¤©)

## å‚è€ƒæ–‡æ¡£è·¯å¾„

### Frankaæœºå™¨äººæŠ€æœ¯æ–‡æ¡£
- **æ§åˆ¶æ¥å£è§„æ ¼**ï¼š`/home/wujielin/CascadeProjects/projects/ws/frk_act_unified/docs/frkdocs/Franka Control Interface Specifications.markdown`
- **franka_rosæ–‡æ¡£**ï¼š`/home/wujielin/CascadeProjects/projects/ws/frk_act_unified/docs/frkdocs/franka_ros Documentation.markdown`
- **libfrankaæ–‡æ¡£**ï¼š`/home/wujielin/CascadeProjects/projects/ws/frk_act_unified/docs/frkdocs/libfranka Documentation.markdown`

### å…³é”®æŠ€æœ¯è§„æ ¼æ‘˜è¦
- **æœºæ¢°ç»“æ„**ï¼š7DOFæœºæ¢°è‡‚ + 2DOFå¹³è¡Œå¤¹çˆª
- **åŠ¨ä½œç©ºé—´**ï¼š8ç»´ï¼ˆ7ä¸ªå…³èŠ‚ + 1ä¸ªå¤¹çˆªï¼ŒèŒƒå›´0-0.08mï¼‰
- **è§‚æµ‹ç©ºé—´**ï¼šqpos(7) + qvel(7) + å¤šç›¸æœºå›¾åƒ
- **æ§åˆ¶é¢‘ç‡**ï¼š1000Hzå®æ—¶æ§åˆ¶
- **é€šä¿¡åè®®**ï¼šFlask HTTPï¼ˆéå®æ—¶ï¼‰ + ROS Topicsï¼ˆå®æ—¶ï¼‰
- **ä»¿çœŸæ”¯æŒ**ï¼šGazebo + FrankaHWSimæ’ä»¶

---

**ç”Ÿæˆæ—¶é—´**ï¼š2025-01-13  
**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.1  
**æ›´æ–°å†…å®¹**ï¼šæ·»åŠ FrankaæŠ€æœ¯æ–‡æ¡£è·¯å¾„å’Œè§„æ ¼æ‘˜è¦  
**ä¸‹ä¸€æ­¥**ï¼šæ ¹æ®Frankaè§„æ ¼æ›´æ–°ä»£ç å®ç°
