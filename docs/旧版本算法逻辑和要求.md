# 算法逻辑与实际实现说明

使用的机械臂：fr3（不带夹爪,末端是传感器+探头）
官方文档参考：
/home/jason/ws/catkin_ws/src/franka_ds/docs/frkdocs/franka_ros Documentation.markdown
/home/jason/ws/catkin_ws/src/franka_ds/docs/frkdocs/libfranka Documentation.markdown
## 算法要求

1.  **终端打印与日志**：
    终端打印通过内部计数器控制，以降低输出频率。详细数据通过log文件的形式记录，日志记录频率为10Hz。
2.  **力传感器配置**：
    力传感器的波特率由launch文件设置为 **921600**。数据的读取和解析由一个专门的C++节点 (`force_sensor_reader`) 完成。
力传感器文档：
@/home/jason/ws/catkin_ws/src/franka_ds/docs/力传感器
其中/home/jason/ws/catkin_ws/src/franka_ds/docs/力传感器/forcesenseRead.py可以顺利获取稳定读数
## 算法逻辑

#### 第一阶段：校准与等待 (CALIBRATION)

1.  **静止与调零**：
    控制器启动时，机械臂保持初始姿态静止。
    同时，一个独立的 `force_sensor_reader` 节点会采集100个样本数据，自动计算力传感器的零点偏移(offset)并完成调零。调零完成的条件是各个方向的力在4s内均小于0.5n；
2.  **等待指令**：
    主控制器会等待一个固定的时间（约8秒）以确保传感器节点已完成调零。随后，它会在终端打印提示信息，并暂停执行，等待用户输入 `start` 指令。

> 此后的所有运动都严格遵守Franka机器人的运动学和动力学约束。
@franka_ds/docs/frkdocs/Franka Control Interface Specifications.markdown

#### 第二阶段：移动至目标点 (TRAJECTORY)

1.  **启动运动**：
    在接收到 `start` 指令后，机械臂开始向代码中一个预设的目标点平滑移动。
2.  **抵达判断**：
    当机械臂末端与目标点的直线距离小于8mm时，视为已到达，阶段结束。

#### 第三阶段：目标点暂停 (PAUSE_AT_TARGET)

1.  **短暂悬停**：
    到达目标点后，机械臂会在此位置稳定悬停2秒，为接下来的接触任务做准备。

#### 第四阶段：探头下探与接触 (PROBE_DESCENT)

1.  **垂直下探**：
    机械臂沿Z轴以1mm/s的速度缓慢向下移动。
2.  **接触检测**：
    控制器实时监测Z轴力的 **变化量**。当力的变化量超过 **0.3N** 时，判定为已接触到物体表面。
3.  **记录与减速**：
    一旦检测到接触，立即记录当前的Z轴接触力作为后续力控制的目标值，并开始平滑减速，减速过程持续1秒。

#### 第五阶段：接触后暂停 (PROBE_PAUSE)

1.  **稳定接触**：
    减速停止后，机械臂在当前接触位置保持静止2秒，以稳定接触状态。

#### 第六阶段：圆周运动与力控制 (CIRCULAR_MOTION)

1.  **圆周运动**：
    暂停结束后，机械臂以当前接触点为起点，开始执行一个半径为 **2.5cm** 的圆周运动 (注意：该半径在代码中硬编码，并非由launch文件参数决定)。
2.  **力反馈控制**：
    在圆周运动开始10秒后，Z轴的 **力反馈控制** 启动。控制器会实时微调Z轴的高度，以动态维持在第四阶段记录的目标接触力，实现恒力接触下的轨迹运动。