# M8128 Users' Manual V2.3

## Sunrise Instruments
**Web**: www.srisensor.com  
**Email**: sri@srisensor.com  
**Tel-USA**: +1-248-974-0597  
**Tel-China**: +86-21-6127-6380  

**Document NO**: M8128-131106  
**Version**: V2.3  

---

## 声明
本文件版权归南宁宇立仪器有限公司（以下简称宇立仪器）所有，文件所包含的信息其知识产权归宇立仪器所有，任何单位和个人不得将此文件用于其他商业活动。本文件适用的对象为宇立仪器生产的数据采集卡 M8128，该采集卡用于6轴力传感器的信号采集。宇立仪器保留对该文件最终解释及更新的权利，使用前请认真阅读该手册，如有疑问，请及时联系我公司，以免造成不必要的损失。

---

## 目录
1. [概述](#1-概述)
2. [快速使用](#2-快速使用)
   - 2.1 [使用 RS232 通信](#21-使用-rs232-通信)
   - 2.2 [以太网通信](#22-以太网通信)
   - 2.3 [CAN 通信](#23-can-通信)
3. [电源线缆、接头定义及指示灯状态](#3-电源线缆接头定义及指示灯状态)
   - 3.1 [电源线缆](#31-电源线缆)
   - 3.2 [接头定义](#32-接头定义)
      - 3.2.1 [19 针雷莫接头](#321-19-针雷莫接头)
      - 3.2.2 [通信接头](#322-通信接头)
   - 3.3 [指示灯](#33-指示灯)
4. [iDAS RD 调试软件](#4-idas-rd-调试软件)
   - 4.1 [概述](#41-概述)
   - 4.2 [指令调试](#42-指令调试)
   - 4.3 [显示实时曲线](#43-显示实时曲线)
5. [指令系统](#5-指令系统)
   - 5.1 [RS232/ETHERNET/CAN 通信配置指令](#51-rs232ethernetcan-通信配置指令)
      - 5.1.1 [UARTCFG 配置 RS232 通信参数](#511-uartcfg-配置-rs232-通信参数)
      - 5.1.2 [EIP 以太网 IP 地址](#512-eip-以太网-ip-地址)
      - 5.1.3 [EMAC 以太网卡 MAC 地址](#513-emac-以太网卡-mac-地址)
      - 5.1.4 [EGW 以太网网关](#514-egw-以太网网关)
      - 5.1.5 [ENM 以太网子网掩码](#515-enm-以太网子网掩码)
      - 5.1.6 [CIDT 配置 CAN ID 类型](#516-cidt-配置-can-id-类型)
      - 5.1.7 [CFIDL 配置 CAN ID 过滤器列表](#517-cfidl-配置-can-id-过滤器列表)
      - 5.1.8 [CRATE 配置 CAN 波特率](#518-crate-配置-can-波特率)
      - 5.1.9 [CFI 配置 CAN 发送间隔](#519-cfi-配置-can-发送间隔)
   - 5.2 [SFWV 查询软件版本](#52-sfwv-查询软件版本)
   - 5.3 [DCPM 配置解耦矩阵](#53-dcpm-配置解耦矩阵)
   - 5.4 [DCPCU 解耦数据计算单位](#54-dcpcu-解耦数据计算单位)
   - 5.5 [SMPF 设置系统采样率](#55-smpf-设置系统采样率)
   - 5.6 [DCKMD 设置数据校验方式](#56-dckmd-设置数据校验方式)
   - 5.7 [GOD 一问一答模式读取数据](#57-god-一问一答模式读取数据)
   - 5.8 [GSD 连续读取数值 IEEE 格式浮点数](#58-gsd-连续读取数值-ieee-格式浮点数)
   - 5.9 [ADJZF 传感器信号调零](#59-adjzf-传感器信号调零)
6. [获取实时数据](#6-获取实时数据)
7. [传感器解耦运算](#7-传感器解耦运算)
   - 7.1 [矩阵解耦的传感器](#71-矩阵解耦的传感器)
   - 7.2 [结构解耦的传感器](#72-结构解耦的传感器)
   - 7.3 [非六轴力传感器](#73-非六轴力传感器)
8. [特殊使用案例](#8-特殊使用案例)
   - 8.1 [多机以太网组网通信](#81-多机以太网组网通信)
   - 8.2 [与其他设备同步采样](#82-与其他设备同步采样)
9. [外形尺寸](#9-外形尺寸)

---

## 1. 概述
M8128 采集卡作为 SRI 多种力传感器的信号处理器，能够提供激励、对信号进行放大、调理、A/D 转换，通过 RS232、CAN、Ethernet 总线与主机进行通信。

**性能描述**：
- **模拟**：
  - 6 通道
  - 可编程的增益
  - 可编程的去除零点偏移
  - 低噪声的仪表放大
- **数字**：
  - 总线：RS232、Ethernet TCP、CAN 通信
  - 24 位 sigma-delta ADC
  - 采样率：10 Hz ~ 2 kHz
  - 分辨率：1/5000 to 1/10000 满量程
- **面板信息**：
  - 模拟接口：LEMO FGG.2B.319.CLAD52Z
  - 数字接口：标准 DB-9 接头（内含 RS232、以太网、CAN 通信）
  - 供电：12 V to 36 V, 200 mA，电源线直径 3.5 mm，长 2 m
  - 电源以及状态指示灯
  - iDAS RD：调试软件，显示实时采样曲线
  - 提供通信指令
  - RS232 和 Ethernet TCP 例程代码

---

## 2. 快速使用
将传感器通过雷莫头接入 M8128，使用串口线或串口线转 RJ45 连接主机，并为采集卡提供 24 V 直流电源。软件操作请参考《iDAS R&D 使用手册》。

### 2.1 使用 RS232 通信
1. 运行 iDAS R&D.exe，PortName 选择端口，Baudrate 选择 115200，点击 Open Port，变红则端口可用。
2. 设备上电，iDAS R&D 软件打印初始化信息。
3. Unit 选择 Eng，选择 CH1-CH6 代表 FX, FY, FZ, MX, MY, MZ，点击 RealTime 查看传感器受力实时曲线。

### 2.2 以太网通信
1. PC 端以太网设置：运行 iDAS R&D.exe，选择 EthToX, TCP 及正确的网卡，设备上电半分钟后，点击 Discover iDAS 按钮，搜索成功后显示“1 iDAS found”。
2. 点击 Open Port，变红则接口可用。Unit 选择 Eng，选择 CH1-CH6 代表 FX, FY, FZ, MX, MY, MZ，点击 RealTime 查看传感器受力实时曲线。

### 2.3 CAN 通信
使用 RS232 通信配置 CAN BUS 的 ID 类型、ID 过滤器列表以及波特率，参考 4.0、5.1.6、5.1.7、5.1.8 章节。根据 3.2.2 章节接头定义制作好 CAN 通信线缆。CAN 通信支持 M8128 的所有指令，但需转换成 ASCII，如发送指令超过 8 个字节的需分成多个数据帧发送。

**示例**：
- **RS232 通信**：
  - 发送：`AT+CIDT=?`
  - 回应：`ACK+CIDT=STD$OK\r\n`
  - 发送：`AT+CFIDL=?`
  - 回应：`ACK+CFIDL=NULL$OK\r\n`
  - 发送：`AT+CRATE=?`
  - 回应：`ACK+CRATE=BR:1000000$OK\r\n`
- **CAN 通信**：
  - 例如 `AT+SMPF=?` 转换成 ASCII 为：`41 54 2B 53 4D 50 46 3D 3F 0D 0A`
  - CAN 传输：
    - 第一帧：`41 54 2B 53 4D 50 46 3D`
    - 第二帧：`3F 0D 0A`（或 `3F 0D 0A 00 00 00 00 00`）

---

## 3. 电源线缆、 Cleveland接头定义及指示灯状态
### 3.1 电源线缆
M8128 需直流电源供电，支持宽电压 12-36V，推荐 24V，接上 SRI 六轴力传感器，设备消耗功率约 4.5W；线缆长 2 米，线缆颜色定义如下：

| 颜色           | 定义       | 备注           |
|----------------|------------|----------------|
| 红、棕、橙     | +24 V      | 电源正，红色香蕉头 |
| 黑、棕、黄、绿 | GND        | 电源负，黑色香蕉头 |
| 屏蔽线         | Shield     |                |

### 3.2 接头定义
#### 3.2.1 19 针雷莫接头
| 接头管脚 | 定义   |
|----------|--------|
| 1        | CH1+   |
| 2        | CH1-   |
| 3        | CH2+   |
| 4        | CH2-   |
| 5        | CH3+   |
| 6        | CH3-   |
| 7        | CH4+   |
| 8        | CH4-   |
| 9        | CH5+   |
| 10       | CH5-   |
| 11       | CH6+   |
| 12       | CH6-   |
| 13~16    | N/A    |
| 17       | -E     |
| 18       | +E     |
| 19       | GND    |

#### 3.2.2 通信接头
DB9 针头集成 Ethernet/RS232/CAN 总线，定义如下：

| 接头管脚 | 定义   | 备注         |
|----------|--------|--------------|
| 1        | TDP    | Ethernet     |
| 2        | RX     | RS232        |
| 3        | TX     | RS232        |
| 4        | CANH   | CAN BUS      |
| 5        | GND    | 接地         |
| 6        | CANL   | CAN BUS      |
| 7        | TDN    | Ethernet     |
| 8        | RDP    | Ethernet     |
| 9        | RDN    | Ethernet     |

### 3.3 指示灯
面板上有两个 LED 指示灯，电源灯 PWR 和状态灯 STA，采集卡的工作状态如下：

| PWR  | STA  | 采集卡状态             | 备注                     |
|------|------|------------------------|--------------------------|
| 常亮 |      | 上电                   |                          |
| 常亮 | 闪烁 | 正常工作               |                          |
| 常亮 | 常亮 |                        |                          |
| 熄灭 | 闪烁 | 正常工作，电源指示灯坏 |                          |
| 熄灭 | 常亮 |                        |                          |

---

## 4. iDAS RD 调试软件
随货发送的 U 盘里有调试软件，主机通过它可以和 M8128 进行收发指令调试，获取多轴力的实时曲线，也可进行指令调试和参数配置，提高二次开发的效率。

- **PC 系统要求**：Windows XP 及以上
- **安装方式**：解压直接运行
- **支持通信**：RS232 和 Ethernet 通信调试

### 4.1 概述
（内容缺失）

### 4.2 指令调试
按照 5.0 指令系统的命令格式，输入指令并点击 Send，在命令回应窗口会有相关信息返回。如果输入错误的指令或 M8128 不支持的指令，则会提示 Error 或无任何回应。在 iDAS R&D 不需要输入 `\r\n`，软件已自动封装。

### 4.3 显示实时曲线
1. 正确打开通信端口。
2. 在软件界面的右下角选择 CH1 至 CH6。
3. 设置参数：
   - SampRate 输入 100 Hz
   - Unit 选择 N 或 Nm
   - PointPerPackage 输入 10
   - Skip 输入 0
4. 在右上角选择 CH1 至 CH6。
5. 点击右下角 RealTime，查看实时数据和曲线。

---

## 5. 指令系统
**定义**：
- **主机**：向 M8128 发送指令的设备，如用户系统、PC 机等。相应的 M8128 称为从机。
- **ASCII 码**：美国信息交换标准码（American Standard Code for Information Interchange），符合 ISO 646 标准。M8128 通信指令采用 ASCII 码方式。

**指令结构**：
- 主机发送指令：`AT+CMD=Parameter\r\n`
- 从机数据回应（GSD 和 GOD 指令除外）：`ACK+CMD=Parameter$ResponseCode\r\n`

**说明**：
- 主机发送指令必须以 `AT` 开头。
- `ACK`：数据回应开头，表示 M8128 收到指令后的回应。
- `CMD`：通信指令，由 ASCII 构成，如 SMPF。
- `Parameter`：指令参数，由 ASCII 构成，注意各参数间的分隔符。
- `\r\n`：回车换行符号（16 进制表示 0D 0A），表示命令结束。
- `ResponseCode`：回应代码，如 OK 或 ERROR。
- `$`：间隔符，不能省略。
- 若指令中 `Parameter` 为 `?`，表示从 M8128 读取数据；否则表示设置 M8128 参数。
- M8128 执行主机发送的指令后，才会做出回应，如 OK 或 ERROR。
- 使用 iDAS R&D 软件调试时，需进行 ASCII 转换。

### 5.1 RS232/ETHERNET/CAN 通信配置指令
#### 5.1.1 UARTCFG 配置 RS232 通信参数
**描述**：配置 RS232 通信参数，如波特率等。  
**指令语法**：`AT+UARTCFG=Parameter`

#### 5.1.2 EIP 以太网 IP 地址
**描述**：设置或查询以太网 IP 地址。  
**指令语法**：`AT+EIP=IP`  
**示例**：
- 设置：`AT+EIP=192.168.0.110`
- 查询：`AT+EIP=?`

#### 5.1.3 EMAC 以太网卡 MAC 地址
**描述**：设置或查询以太网卡 MAC 地址。  
**指令语法**： musulAT+EMAC=MAC`  
**示例**：
- 设置：`AT+EMAC=10-11-12-13-14-20`
- 查询：`AT+EMAC=?`

#### 5.1.4 EGW 以太网网关
**描述**：设置或查询以太网网关地址。  
**指令语法**：`AT+EGW=Gateway`

#### 5.1.5 ENM 以太网子网掩码
**描述**：设置或查询以太网子网掩码。  
**指令语法**：`AT+ENM=Netmask`

#### 5.1.6 CIDT 配置 CAN ID 类型
**描述**：配置 CAN 通信的 ID 类型。  
**指令语法**：`AT+CIDT=Type`  
**示例**：
- 查询：`AT+CIDT=?`
- 回应：`ACK+CIDT=STD$OK\r\n`

#### 5.1.7 CFIDL 配置 CAN ID 过滤器列表
**描述**：配置 CAN ID 过滤器列表。  
**指令语法**：`AT+CFIDL=List`  
**示例**：
- 查询：`AT+CFIDL=?`
- 回应：`ACK+CFIDL=NULL$OK\r\n`

#### 5.1.8 CRATE 配置 CAN 波特率
**描述**：配置 CAN 通信波特率。  
**指令语法**：`AT+CRATE=Rate`  
**示例**：
- 查询：`AT+CRATE=?`
- 回应：`ACK+CRATE=BR:1000000$OK\r\n`

#### 5.1.9 CFI 配置 CAN 发送间隔
**描述**：配置 CAN 数据发送间隔。  
**指令语法**：`AT+CFI=Interval`

### 5.2 SFWV 查询软件版本
**描述**：查询软件版本号。  
**指令语法**：`AT+SFWV=?`

### 5.3 DCPM 配置解耦矩阵
**描述**：设置或读取传感器解耦矩阵。  
**指令语法**：`AT+DCPM=Matrix`  
**示例**：
- 设置：
  ```
  AT+DCPM=(-0.03220,0.49984,0.00136,-1.01398,-0.01208,0.50908);(0.00046,0.84855,0.01531,0.02114,-0.03126,-0.86432);(1.19167,0.00028,1.20748,0.00224,1.19808,0.00320);(-0.06386,-0.00097,0.13028,-0.00009,-0.06523,0.00012);(-0.11090,0.00046,-0.00049,0.00075,0.11138,-0.00019);(-0.00046,0.08401,-0.00067,0.08304,-0.00089,0.08433)
  ```
- 查询：`AT+DCPM=?`

### 5.4 DCPCU 解耦数据计算单位
**描述**：设置或读取计算工程单位时采用的数据单位。  
**指令语法**：`AT+DCPCU=Unit`  
**示例**：
- 设置：`AT+DCPCU=MV`
- 查询：`AT+DCPCU=?`

### 5.5 SMPF 设置系统采样率
**描述**：设置或读取系统的采样率。  
**指令语法**：`AT+SMPF=SampleFreq`  
**示例**：
- 设置：`AT+SMPF=100`
- 查询：`AT+SMPF=?`

### 5.6 DCKMD 设置数据校验方式
**描述**：设置数据校验方式。  
**指令语法**：`AT+DCKMD=Method`

### 5.7 GOD 一问一答模式读取数据
**描述**：采用一问一答模式读取数据，即发送一次指令仅获得一次数据。  
**指令语法**：`AT+GOD`

### 5.8 GSD 连续读取数值 IEEE 格式浮点数
**描述**：用于连续读取采样数据，从机连续上传数据，不中断。  
**指令语法**：`AT+GSD`

### 5.9 ADJZF 传感器信号调零
**描述**：调零传感器信号。  
**指令语法**：`AT+ADJZF=Parameters`  
**示例**：
- 发送：`AT+ADJZF=?`
- 回应：`ACK+ADJZF=0;0;0;0;0;0$OK\r\n`
- 发送：`AT+ADJZF=1;1;1;1;1;1`

---

## 6. 获取实时数据
如需自己编写代码与 M8128 采集卡通信获取数据，请参考以下指令流程：
1. 通过 SMPF 指令设置期望数据上传的频率，例如：`AT+SMPF=100\r\n`
2. 通过 GOD 或 GSD 指令实现单点或连续上传实时数据，参考 5.7 和 5.8 指令介绍。

**注意**：
- 以上指令会掉电保存。
- 在代码调试过程中，如果用到 iDAS R&D 软件，代码再次调试时需对采集卡重新上电。
- 如果读回数据不正确，请确定传感器的解耦矩阵是否正确输入到采集卡，参考 5.3 和 5.4 指令介绍。

---

## 7. 传感器解耦运算
M8128 采集卡出厂时已配置好 SRI 多轴力传感器的解耦矩阵，如有必要可通过 DCPM 和 DCPCU 指令修改出厂设置。解耦矩阵系数和运算单位可通过传感器的出厂标定报告获得，SRI 根据传感器结构提供两种报告格式。

### 7.1 矩阵解耦的传感器
报告中直接提供解耦矩阵系数和运算单位：

```
[DECOUPLED] = 
-0.03220, 0.49984, 0.00136, -1.01398, -0.01208, 0.50908
0.00046, 0.84855, 0.01531, 0.02114, -0.03126, -0.86432
1.19167, 0.00028, 1.20748, 0.00224, 1.19808, 0.00320
-0.06386, -0.00097, 0.13028, -0.00009, -0.06523, 0.00012
-0.11090, 0.00046, -0.00049, 0.00075, 0.11138, -0.00019
-0.00046, 0.08401, -0.00067, 0.08304, -0.00089, 0.08433
```

**解耦步骤**：
1. 获取通道 1 至 6 的原始数据（单位：mV）：  
   `[DAT] = [rawchn1, rawchn2, rawchn3, rawchn4, rawchn5, rawchn6]`
2. 计算解耦负载：  
   `[RESULT] = [DECOUPLED][DAT]`  
   其中 `[RESULT] = [FX, FY, FZ, MX, MY, MZ]`，力单位：N，力矩单位：Nm

**解耦系数输入**：
```
AT+DCPM=(-0.03220,0.49984,0.00136,-1.01398,-0.01208,0.50908);(0.00046,0.84855,0.01531,0.02114,-0.03126,-0.86432);(1.19167,0.00028,1.20748,0.00224,1.198078,0.00320);(-0.06386,-0.00097,0.13028,-0.00009,-0.06523,0.00012);(-0.11090,0.00046,-0.00049,0.00075,0.11138,-0.00019);(-0.00046,0.08401,-0.00067,0.083040,-0.00089,0.08433)
AT+DCPCU=MV
```

### 7.2 结构解耦的传感器
报告中提供灵敏度，需通过灵敏度转换成解耦矩阵系数。（具体灵敏度表格缺失）

### 7.3 非六轴力传感器
如三轴力、单轴力或扭矩传感器等的解耦矩阵系数。（具体内容缺失）

---

## 8. 特殊使用案例
### 8.1 多机以太网组网通信
多个 M8128 通过交换机与电脑组网通信。

**操作步骤**：
1. 将电脑 IP 地址设置为 `192.168.0.112`。
2. 发送 EIP 指令，将第一个 M8128 的 IP 地址设置为 `192.168.0.110`。
3. 发送 EMAC 指令，将第一个 M8128 的 MAC 地址设置为 `10-11-12-13-14-20`。
4. 发送 EIP 指令，将第二个 M8128 的 IP 地址设置为 `192.168.0.111`。
5. 发送 EMAC 指令，将第二个 M8128 的 MAC 地址设置为 `10-11-12-13-14-21`。
6. 在 iDAS R&D 软件上，设置 PortName 为 EthToX，点击 Discover iDAS 按钮，搜索网络上的所有 M8128。
7. 切换 TargetHost 的 IP 地址为相应的 M8128 地址后点击 Open Port 打开通信端口。
8. 切换 TargetHost 的 IP 地址为 `192.168.0.111`，与第二个 M8128 通信。

### 8.2 与其他设备同步采样
M8128XXT 支持外部触发采样。

**操作步骤**：
1. 使用 SRI 提供的特殊电缆，接头 1 连接至 M8128XXT，接头 2 或 3 连接至电脑，接头 4 连接至第三方设备。
2. 所有设备上电。
3. 打开 iDAS R&D 软件并与 M8128XXT 建立通信连接，参考第 2 章。
4. 单击 iDAS R&D 软件的 "Realtime" 按钮。
5. 当触发 I/O 的电压变为低电平（<0.3V），M8128XXT 被触发，开始采样。触发 I/O 需保持低电平直到采样结束。触发 I/O 变为高电平（>2.7V）结束采样。

---

## 9. 外形尺寸
（具体外形尺寸内容缺失）

---

**Sunrise Instruments**  
**Web**: www.srisensor.com  
**Email**: sri@srisensor.com  
**Tel-USA**: +1-248-974-0597  
**Tel-China**: +86-21-6127-6380