# M4313MXB Users' Manual V1.0

## 声明
本文件的知识产权归字立仪器所有，任何单位和个人不得将此文件用于其他商业活动。本文件适用的对象为字立仪器生产的六轴力传感器 M4313MXB，该传感器内置了数据采集卡。字立仪器保留对该文件最终解释及更新的权利。使用前请认真阅读本手册，如有疑问，请及时联系我公司，以免造成不必要的损失。

---

## 目录
- [M4313MXB Users' Manual V1.0](#m4313mxb-users-manual-v10)
  - [声明](#声明)
  - [目录](#目录)
  - [1. 概述](#1-概述)
  - [4. 指令系统](#4-指令系统)
    - [4.1 SFWV 查询软件版本](#41-sfwv-查询软件版本)
    - [4.2 DCPMA6X8 配置解耦矩阵](#42-dcpma6x8-配置解耦矩阵)
    - [4.3 DCPCU 解耦数据计算单位](#43-dcpcu-解耦数据计算单位)
    - [4.4 SMPF 设置系统采样率](#44-smpf-设置系统采样率)
    - [4.5 GOD 一问一答模式读取数据](#45-god-一问一答模式读取数据)
    - [4.6 GSD 连续读取数值 IEEE 格式浮点数](#46-gsd-连续读取数值-ieee-格式浮点数)
  - [5. 读取实时数据](#5-读取实时数据)

---

## 1. 概述
M4313MXB 是 SRI 六轴力传感器，内置数据采集卡，+24V 供电，对信号进行放大、滤波、A/D 转换，通过 Ethernet TCP/IP、RS232 与主机进行通信。

**内置数据采集性能描述**：
- 模拟量输入
- 低噪声的 RS232 通信
- 24 位 sigma-delta ADC
- 采样率：10 Hz - 2 kHz
- 分辨率：1/5000 至 1/10000 满量程
- iDAS RD：调试软件，显示实时采样曲线



## 4. 指令系统
**定义**：
- **主机**：向传感器发送指令的设备，如用户系统、PC 机等。相应的传感器称为从机。
- **ASCII 码**：美国信息交换标准码（American Standard Code for Information Interchange），符合 ISO 646 标准。传感器通信指令采用 ASCII 码方式。

**指令结构**：
- 主机发送指令：`AT+CMD=Parameter\r\n`
- 从机数据回应（GSD 和 GOD 指令除外）：`ACK+CMD=Parameter$ResponseCode\r\n`

**说明**：
- 主机发送指令必须以 `AT` 开头。
- `ACK`：数据回应开头，表示传感器收到指令后的回应。
- `CMD`：通信指令，由 ASCII 构成，如 SMPF。
- `Parameter`：指令参数，由 ASCII 构成，注意各参数间的分隔符。
- `\r\n`：回车换行符号（16 进制表示 0D 0A），表示命令结束。
- `ResponseCode`：回应代码，如 OK 或 ERROR。
- `$`：间隔符，不能省略。
- 若指令中 `Parameter` 为 `?`，表示从传感器读取数据；否则表示设置传感器参数。
- 传感器执行主机发送的指令后，才会做出回应，如 OK 或 ERROR。
- 使用 iDAS R&D 软件调试时，需进行 ASCII 转换。

**示例**：
- 发送：`AT+SMPF=?\r\n`
  - ASCII：`41 54 2B 53 4D 50 46 3D 3F 0D 0A`
  - 回应：`ACK+SMPF=100$OK\r\n`
  - ASCII：`41 43 4B 2B 53 4D 50 46 3D 31 30 30 24 4F 4B 0D 0A`
- 发送：`AT+GOD\r\n`
  - ASCII：`41 54 2B 47 4F 44 0D 0A`
  - 回应：`AA 55 00 1B 04 BB A1 8C B8 41 E0 19 30 42 DD 82 B0 40 A2 62 B8 C0 DB 68 75 40 9B EB 16 40 30`

### 4.1 SFWV 查询软件版本
**描述**：查询软件版本号。  
**指令语法**：`AT+SFWV=?`  
**示例**：
- 发送：`AT+SFWV=?`
- 回应：`ACK+SFWV=V11.00$OK`

### 4.2 DCPMA6X8 配置解耦矩阵
**描述**：设置或读取传感器解耦矩阵。  
**指令语法**：`AT+DCPMA6X8=Matrix`  
**示例**：
- 发送：`AT+DCPMA6X8=?`
- 回应：
  ```
  ACK+DCPMA6X8=(0.000348,0.13516,-0.000649,0.136403,0.000784,-0.131532,0.001781,-0.132775);(0.000468,-0.136538,-0.000928,0.132426,-0.003254,0.132514,-0.001858,-0.13645);(0.111238,-0.000423,0.110047,0.000772,0.109236,0.000134,0.110427,-0.001061);(-0.002168,-0.000008,-0.002145,-0.000016,0.002112,-0.000001,0.002089,0.000007);(0.002192,0.000016,-0.002103,0.000033,-0.002099,-0.000026,0.002195,-0.000043);(0.000005,0.001674,-0.00003,0.001869,-0.000023,0.001646,0.000012,0.001452)$OK
  ```
- 发送：
  ```
  AT+DCPMA6X8=(0.000348,0.13516,-0.000649,0.136403,0.000784,-0.131532,0.001781,-0.132775);(0.000468,-0.136538,-0.000928,0.132426,-0.003254,0.132514,-0.001858,-0.13645);(0.111238,-0.000423,0.110047,0.000772,0.109236,0.000134,0.110427,-0.001061);(-0.002168,-0.000008,-0.002145,-0.000016,0.002112,-0.000001,0.002089,0.000007);(0.002192,0.000016,-0.002103,0.000033,-0.002099,-0.000026,0.002195,-0.000043);(0.000005,0.001674,-0.00003,0.001869,-0.000023,0.001646,0.000012,0.001452)
  ```
- 回应：
  ```
  ACK+DCPMA6X8=(0.000348,0.13516,-0.000649,0.136403,0.000784,-0.131532,0.001781,-0.132775);(0.000468,-0.136538,-0.000928,0.132426,-0.003254,0.132514,-0.001858,-0.13645);(0.111238,-0.000423,0.110047,0.000772,0.109236,0.000134,0.110427,-0.001061);(-0.002168,-0.000008,-0.002145,-0.000016,0.002112,-0.000001,0.002089,0.000007);(0.002192,0.000016,-0.002103,0.000033,-0.002099,-0.000026,0.002195,-0.000043);(0.000005,0.001674,-0.00003,0.001869,-0.000023,0.001646,0.000012,0.001452)$OK
  ```

### 4.3 DCPCU 解耦数据计算单位
**描述**：设置或读取计算工程单位时采用的数据单位。  
**指令语法**：`AT+DCPCU=Unit`  
**示例**：
- 发送：`AT+DCPCU=?\r\n`
- 回应：`ACK+DCPCU=MV$OK\r\n`

### 4.4 SMPF 设置系统采样率
**描述**：设置或读取系统的采样率。  
**指令语法**：`AT+SMPF=SampleFreq`  
**示例**：
- 发送：`AT+SMPF=?`
- 回应：`ACK+SMPF=300$OK`
- 发送：`AT+SMPF=200`
- 回应：`ACK+SMPF=200$OK`

### 4.5 GOD 一问一答模式读取数据
**描述**：采用一问一答模式读取数据，即发送一次指令仅获得一次数据。  
**指令语法**：`AT+GOD`

### 4.6 GSD 连续读取数值 IEEE 格式浮点数
**描述**：用于连续读取采样数据，从机连续上传数据，不中断。  
**指令语法**：`AT+GSD`

**从机回应数据格式**：
| 数据包头 | PackageLength | PackageNo | Data | CRC32/SUM |
|----------|---------------|-----------|------|-----------|
| 0xAA,0x55 | HB,LB | 2Byte | (ChNum*N*DNpCH) Byte | 4Byte / 1Byte |

**说明**：
- `0xAA,0x55`：数据包头。
- `PackageLength`：16bit 整数变量，占用 2B，高字节在前，低字节在后。数据大小表示为 `(HB*256+LB)`。
  - 使用 SUM 校验整个数据包长度等于 `ChNum*N*DNpCH`。
  - 使用 CRC32 校验整个数据包长度等于 `ChNum*N*DNpCH`。
- `ChNum`：上传的通道数，默认是 6。
- `N`：上传数据的单位，默认是 4。
- `DNpCH`：上传通道数据的点数，默认是 1。
- `PackageNo`：数据包编号，从 0 到 65535 顺序递增并循环，可用于检查是否丢包。
- `Data`：通道 1 至 6 的数据，低位在前，高位在后。
- `CRC32/SUM`：CRC32 或 SUM 只对 Data 部分进行校验，默认使用 SUM 校验。

---

## 5. 读取实时数据
可以通过 DCKMD 指令修改校验方式。

---

**Sunrise Instruments**  
Nanning 530007, China  
45499 Irvine Dr., Novi, MI 48374, USA  
**Tel**: +86-137-0788-0181 / +1-248-962-3088  
**Email**: sri@srisensor.com  
**Web**: www.srisensor.com