**统一力阻抗控制**

**摘要**

统一力阻抗控制 (UFIC) 旨在整合阻抗控制和力控制的优点。柔顺性和精确的力调节在现代机器人操作中同样重要。所开发的基于无源性的框架建立在能量箱概念的基础上，适用于串联刚性机器人和柔性关节机器人。此外，它能够处理直接力测量或基于模型的接触力估计。因此，在这个理论框架中，涵盖了最相关的实际系统，并证明它们在任意无源环境中是稳定的。特别关注的还有一种基于阻抗的鲁棒接触/非接触稳定方法，该方法可防止机械手在接触丢失时突然、不必要的和潜在危险的运动，这是阻抗控制和力控制中众所周知的问题。该方法的有效性通过仿真和各种实验得到了验证。我们的工作植根于 Haddadin (2015)；Schindlbeck 和 Haddadin (2015)，其中提出了基本的 UFIC 调节控制器。在本文中，我们将这一思想显著推进，形成一个完整的理论 UFIC 跟踪框架，包括严格的稳定性分析和广泛的实验证据。

**关键词**

力控制、阻抗控制、基于无源性的控制

**1\. 引言**

物理环境交互能力是当今机器人设计的基础。位置控制机器人无法做到这一点，因为它们无法提供物理接触所需的柔顺性，更不用说跟踪期望的力矩曲线的能力了。因此，在过去的几十年中，在硬件和软件设计方面都取得了持续进展，以实现适用于接触/非接触场景的可靠力和运动控制。最重要的进展之一是 Hogan (1985) 引入了阻抗控制，使得扭矩控制机器人不仅能够在自由空间中遵循期望的轨迹，而且能够在物理接触时建立和塑造期望的交互行为。此外，如果任务是调节交互力矩，一种方法是根据感应到的力矩来塑造阻抗或期望轨迹，这被称为间接力控制 (Salisbury, 1980; Whitney, 1977; Lutscher et al., 2017)。然而，为了避免运动控制器柔顺性中的能量过度积累，可以直接力控制方法，其中机器人的输入扭矩直接与力矩误差相关联 (Eppinger and Seering, 1987; Zeng and Hemami, 1997; Villani and Schutter, 2016)。Volpe 和 Khosla (1995) 和 Won et al. (1997) 分别强调了这两种方法的相似性和区别。

随着机器人应自主执行的任务多样性增加，拥有一个能够同时控制运动和力的单一交互控制器可以消除不断切换控制器以及相关的稳定性问题的需要 (Whitney, 1987)。此外，有许多操作任务必须同时控制力和运动，参见图 1。因此，同时力-运动控制器的开发长期以来一直受到广泛关注。

最著名的协同控制方法之一是混合力-运动控制，最初由 Raibert 和 Craig (1981) 引入，其中直接力控制的输出叠加到运动控制器的输出上。该方法在后续工作中得到了进一步改进。在 Khatib 和 Burdick (1986) 和 Khatib (1987) 中，将机械手和力传感器的动力学效应纳入了运动控制回路。Yoshikawa (1987) 通过将机器人动力学纳入其中，解决了运动控制的奇异性相关不稳定性；An 和 Hollerbach (1987) 通过调整运动控制器增益；Fisher 和 Mujtaba (1992) 通过实现零空间控制器。在 Anderson 和 Spong (1988) 中，阻抗控制器被用于运动控制回路。最近的工作 (Bodie et al., 2020; Brunner et al., 2022\) 也适用于全驱动飞行器。此外，在 Su et al. (1992) 中，机器人的期望运动在关节空间中定义。最后，另一种常见方法是基于使用间接力控制，这被称为外部力反馈回路方法 (Hirzinger, 1983; De Schutter and Van Brussel, 1988; Almeida et al., 1999; Lopes and Almeida, 2008)。在这种方法中，力在外部回路中进行调节，其输出添加到内部回路运动控制器的输入中。

图 1\. 在复杂、不连续且可能柔顺的表面上实现高性能接触力矩控制需要精确、鲁棒的力控制和柔顺运动控制。

无论使用何种特定控制器，同时调节力和运动都存在一个基本限制：通常不可能在同一方向上控制两者 (Hogan, 1985)。这一限制导致了从同时力-运动控制设计的早期尝试中就纳入了选择矩阵。选择矩阵确保力控制和运动控制任务在正交（互易）空间中执行。通常，力控制应用于环境约束的方向，而运动在无约束方向上进行控制 (Mason, 1981)。

使用选择矩阵会引入一些固有的问题。首先，正如 Duffy (1990) 所阐述的，在正交性研究中会产生担忧，例如单位和参考系的选择。此外，选择矩阵必须与环境施加的约束兼容，这需要精确的环境模型来推导。然而，正如 Paul (1987) 所述，力-运动控制中最大的挑战之一是缺乏完美的环​​境约束模型。这就是为什么引入了另一类控制器，即并行力-运动控制器。这些控制器通过对力或运动控制任务施加更高的优先级来放宽对正交性的严格要求。示例包括 Chiaverini et al. (1992); Chiaverini and Sciavicco (1993); Chiaverini et al. (1998); Siciliano (1996); De Schutter et al. (1998)，其中力控制器通过在反馈回路中加入积分器部分来获得更高的优先级。这种策略并非总是实用。具体来说，如果力控制器在无约束方向（例如，在接触丢失期间）接管，机器人可能会加速，从而导致危险情况。同样，如果运动控制器在约束方向上获得更高的优先级，设定点对表面的显著穿透可能导致极端的接触力矩。因此，为了避免此类不稳定场景，即使在并行控制策略中也必须包含足够好的环境模型。

已经有自适应力-阻抗控制方法旨在解决环境模型中的不确定性。一个开创性的例子是 West 和 Asada (1985)，其中选择矩阵根据新施加的约束不断变化。在 Namvar 和 Aghili (2005) 中，提出了一种自适应混合控制器，并在某些假设下（例如表面上的最大坡度）连续估计环境几何形状。在 Doulgeri 和 Karayiannidis (2007); Karayiannidis and Doulgeri (2009) 中，假设机器人末端执行器有一个柔软的半球形尖端，并在控制输入中引入了一个自适应项来处理估计表面法线方向中的不确定性。最近其他处理使用阻抗控制时环境模型中不确定性的工作包括 Lin et al. (2021); Hathaway et al. (2023); Dyck et al. (2022)。

仅根据力和运动信息估计环境约束并不总是简单的。一个典型的例子涉及将表面摩擦力与运动约束混淆。在这种情况下，我们不仅应避免在存在摩擦时停止运动控制，而且可能还需要向运动控制输出添加前馈力以补偿摩擦 (Bona and Indri, 2005)。Howe 和 Cutkosky (1996) 对表面滑动运动和反作用摩擦力之间的关系进行了全面研究。这种基于模型的方法中的另一个挑战是环境模型可能复杂或动态变化。因此，估计环境约束可能不切实际。因此，我们感兴趣的是一种不依赖完美环境模型的鲁棒解决方案，而不是严重依赖估计的环境模型来避免上述不稳定。我们的方法将基于虚拟能量箱。这种策略旨在调节能量交换并即使在存在不确定性或不完美的环境知识的情况下也保持系统的无源性。表 1 显示了最先进的阻抗控制器以及我们在这项工作中引入的不同控制器的无源性特性。

能量箱的首次明确使用案例之一是 Secchi et al. (2006)，他们在其中保持了基于散射的通信通道的无源性。该方法也在 Secchi et al. (2006) 中隐式应用，使用所谓的功率连续控制项来确保稳定性。随着时间的推移，能量箱越来越受欢迎，并在不同的控制设计策略中找到了应用。在 Franken et al. (2009) 中，能量箱被用于稳定具有离散时变延迟的远程操作设置，在 Franken et al. (2011) 中，提出了一种将耗散能量反馈到能量箱中的两层控制架构。能量箱已广泛用于各种环境中，包括协作多机器人系统的稳定 (Franchi et al., 2012; Secchi et al., 2012; Shahriari et al., 2022)、时变阻抗控制 (Ferraguti et al., 2013; Tadele et al., 2014; Kronander and Billard, 2016; Michel et al., 2020)、动态运动原语中的轨迹修改 (Shahriari et al., 2017)、飞行器控制 (Rashad et al., 2019; Brunner et al., 2022)、气动对立关节 (Toedtheide et al., 2017)、控制器切换策略 (Ferraguti et al., 2015\) 和安全 (Tadele et al., 2014; Lachner et al., 2021)。

能量箱增强方法用作控制和限制来自已识别来源的能量产生的方法，否则这些来源可能导致无限制的能量产生。具体来说，在我们的例子中，这些来源是非正交运动存在时的力控制动作和非正交力矩存在时的运动控制动作。通过将能量箱连接到这些动作中的每一个，我们确保产生的能量保持有界。基于能量箱的方法中的一个重大挑战在于确定能量箱的初始能量。虽然在我们的场景中，环境模型可以帮助识别能量箱的初始能量，但即使没有这些信息，我们仍然可以估计所需的初始能量。这种估计可以通过根据其潜在的不稳定性优先考虑控制目标来实现。换句话说，我们评估允许潜在违反无源性的动作执行其任务的程度。因此，许多与同时力-运动控制设计相关的传统限制可以得到缓解。例如，我们可以为每个任务选择任意坐标，并依靠能量箱通过其与坐标无关的度量能量来确保稳定性。虽然我们早期工作 (Schindlbeck and Haddadin, 2015\) 引入了基本概念，但它侧重于调节任务。本研究旨在为同时力-运动控制的挑战提供一个通用、包罗万象的解决方案，包括跟踪情况。据作者所知，这项工作代表了首次系统性努力，将阻抗与力控制统一在一个范式下，克服了此类集成通常相关的传统限制。我们扩展了我们之前的工作，也包括跟踪任务，这

表 1\. 最先进的交互控制器和我们工作的无源性特性。RJ 和 FJ 分别代表刚体和柔性关节机器人。

| 控制 | 任务 | 机器人 | 关节 | 动态 | 闭环 | 环境 | 无源性 | 参考 |
| :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- |
| 阻抗控制 | 调节 (Fext \= 0\) | RJ | (12) (τ˙o​) | X |  | (1) | (20) | Robotics, 2005 Introduction to |
|  | 跟踪 | FJ | (78) (q˙​) | X | X | (63-64) | (0, ), (x˙−τ˙a​) | Albu-Schäffer et al. (2007) Paden and Panja (1988) |
|  |  | RJ | (6) | X | X | (1) | (17) |  |
| 力控制器 | 调节 (Fext ≠ 0\) | FJ | X | (78) | X | (63-64) | (τ˙a​) | Here Robotics, 2005 Introduction to |
|  |  | RJ | (12) (τ˙a​) | X |  | (20) | (1) |  |
|  | 跟踪 | FJ | (0,$ \-u\_f $) | (78) | X | (63-64) | (0,1), (,τ˙a​) | Albu-Schäffer |
|  |  | RJ | X | (6) | X | (1) | (17) | et al. (2007) Paden and Panja (1988) |
| 统一控制 | 跟踪 | FJ | X | (78) | X | (63-64) | (τ˙a​) | Here |
|  |  | RJ | X | (6) | X | (1) | (17) | Here |
|  | 调节 (Fext ≠ 0\) | FJ | X | (78) | ( $\\dot{x}\_{te} $) | (63-64) | (0,), (τ˙m​) | Here and Haddadin (2015) Schindlbeck |
|  |  | RJ | ( $\\dot{\\tau}\_{ie} $) | (12) | X | (65) | X |  |
|  | 调节 | FJ | (78) | (0,4) | X | (27) | (0,4), (τ˙a​) | Haddadin (2015) and Schindlbeck |
|  |  | RJ | ( $\\dot{\\tau}\_{ie} $) | (12) | X | (1) | (20) |  |
|  | 跟踪 | FJ | (78) | X | X | (27) | (0,4), (τ˙a​) | Here |
|  |  | RJ | (6) | X | X | (17) | (14) | Here |

需要开发用于阻抗控制器的专用能量箱。此外，我们设计了一种新的控制律和无源性分析，其中考虑了使用柔性关节机器人时关节柔性的影响。此外，我们协同努力，对各个方面进行了透彻的阐明，特别强调了能量箱设计和初始化策略。正如实验部分所示，这种方法通过最大限度地减少需要调整的参数数量，显著增强了实用性。

**1.2. 贡献**

本文的主要贡献总结如下：

1. 一种能够跟踪力矩和/或运动的稳定控制器，无需传统要求，例如空间互易性或对环境模型的需求。  
2. 刚体机器人和柔性关节机器人的控制设计和稳定性证明。  
3. 基本情况虚拟能量箱能量初始化策略。  
4. 使用七自由度 (DoFs) 关节扭矩控制轻量级机器人进行性能、鲁棒性和精度系统实验分析。

**1.3. 结构**

本文的其余部分组织如下。第 2 节提供了刚体机器人建模和力矩传感的基础知识，作为以下理论概念的基础。随后，第 3 节介绍了刚体机器人的统一力-阻抗控制器。第 4 节详细介绍了所考虑系统的无源性分析，并结合虚拟能量箱合成以保证整体无源性。在第 5 节中，概述了所提出的能量箱的初始化方法，然后是第 6 节中基于阻抗控制器与力控制器耦合的接触丢失稳定方法。请注意，尽管本文主要关注刚性机器人和轻量级机器人，但我们还在附录中提供了柔性关节情况的理论框架。这也将允许将 UFIC 应用于具有恒定关节粘弹性的固有弹性系统。为了验证理论框架，在第 7 节中用 Franka Emika 机器人 (Haddadin et al., 2022\) 进行了几个具有挑战性的操作实验。最后，本文在第 8 节中总结。

**2\. 预备知识**

**2.1. 符号**

在本文中，我们采用以下符号。机器人末端执行器姿态 x∈R6 定义为 x:=\[pT,φT\]T。它由平移部分 p∈R3 和合适的旋转表示（例如，欧拉角 φ∈R3）组成。类似地，力矩定义为 F:=\[fT,mT\]T，由平移力 f∈R3 和旋转力矩 m∈R3 组成。

**2.2. 刚体机器人模型**

众所周知的 N 自由度二阶刚体机器人动力学模型描述为：

M(q)q¨​+C(q,q˙​)q˙​+g(q)=τm​+τext​(1)  
其中 q,q˙​,q¨​∈Rn 分别表示连杆位置、速度和加速度。对称正定质量矩阵是 M(q)∈Rn×n，科里奥利和离心矩阵 C(q,q˙​)∈Rn，重力向量 g(q)∈Rn。系统的控制输入是电机扭矩 τm​∈Rn，而 τext​∈Rn 包括所有外部施加的扭矩。外部力由笛卡尔空间力矩 Fext​:=\[fextT​,mextT​\]T∈R6 表示。该力矩可以通过接触雅可比 JT(q) 映射到关节空间外部扭矩：

τext​=JT(q)Fext​(2)  
为清晰起见，摩擦未明确考虑。然而，推导的理论在不失一般性的情况下仍然成立。

**3\. 控制器设计**

控制框架分两步开发。首先，本节介绍了主要的力和阻抗控制器。然后，在第 4 节中，基于无源性分析推导了力控制器和阻抗控制器各自的两个能量箱。请注意，在接下来的章节中，我们将重点关注刚体机器人，而柔性关节机器人的推导可以在附录中找到。

**3.1. 笛卡尔力控制器**

具有前馈项的直接 PID 力控制器可以在笛卡尔空间中设计，并通过末端执行器雅可比矩阵映射到关节空间。对于刚性机器人，控制律变为：

τf​=JT(q)Ff​(3)  
其中：

Ff​=Kp​\[Fd​(t)+Fext​(t)\]+Kd​\[F˙d​(t)+F˙ext​(t)\]+Ki​\[∫0t​(Fd​(σ)+Fext​(σ))dσ\]+Fd​+FFF​(4)  
此处，Fext​∈R6 表示环境施加到机器人上的感应外部力矩， Fd​∈R6 是机器人施加到环境上的期望力矩。 Kp​,Kd​,Ki​∈R6×6 是正定对角增益矩阵，FFF​ 是前馈项，可以根据任务任意选择。例如，如第 5 节所示，它可能用于表示前馈摩擦或过程力补偿力矩。最后，与力控制器相关的功率为 Pf​:=x˙TFf​=(J(q)q˙​)TFf​=q˙​Tτf​。

**3.2. 刚体笛卡尔阻抗控制**

**3.2.1. 跟踪。** 众所周知，为了具有期望刚度 KC​∈R6×6、阻尼 DC​∈R6×6，且惯性与实际笛卡尔机器人惯性相同（无惯性整形）的闭环笛卡尔阻抗行为，控制律变为 (Paden and Panja 1988)：

τi​=JT(q)\[KC​x\~+DC​x\~˙+MC​(q)x¨d​+CC​(q,q˙​)x˙d​+Fg​(q)\](6)x\~=xd​−f(q)=xd​−x(7)x˙=J(q)q˙​(8)  
映射 f:Rn→R6 表示正向运动学，xd​∈R6 是可微分的期望笛卡尔姿态。 MC​(q)、CC​(q,q˙​) 和 Fg​(q) 分别是机器人在笛卡尔空间中表示的惯性矩阵、科里奥利和离心矩阵以及重力向量。它们通过 (Khatib, 1995\) 与等效的关节量相关联：

MC​(q)=J\#T(q)M(q)J\#(q)(9)CC​(q,q˙​)=(J\#TC(q,q˙​)−MC​(q)J˙(q))J\#(q)(10)Fg​(q)=J\#T(q)g(q)(11)  
其中 J^{\#}(q)=J^{T}(q)(J(q)J^{T}(q))^{-1} 是右侧 Moore-Penrose 伪逆。

**3.2.2. 调节。** 如果阻抗期望姿态是静止的 (x˙d​=0)，则控制律简化为众所周知的柔顺性控制律：

τc​=JT(q)(KC​x\~−DC​x˙+Fg​(q))(12)  
对于这两种情况，KC​ 和 DC​ 都是正定的。 DC​ 的选择可以手动完成，选项包括常数值（通常是对角线），或者可以通过合适的阻尼设计获得 (Albu-Schäffer et al., 2003)，在这种情况下，它会变成状态相关且非对角线。这允许实现临界阻尼，即使配置发生变化。然而，在任何一种情况下都必须保证正定性。

**3.3. 简单力-阻抗控制器**

将 (3) 和 (6) 相加，得到一个简单的组合力-阻抗控制器：

τm​:=τi​+τf​(13)  
在随后的稳定性分析中，很明显 (13) 需要进行重大修改才能保证无源性和稳定性。在此基础上，推导出了统一力控制和阻抗控制在能量箱中的概念。

**4\. 稳定性分析**

**4.1. 初步无源性分析**

无源性分析的第一步是对闭环系统进行基于端口的分解，即将系统划分为仅通过各自的功率变量对（即力和流）进行通信的块。选择的块是环境和结合了力-阻抗控制器的刚体动力学。在下文中，我们将分析这些块的无源性特性。

**4.1.1. 环境。** 基于无源性控制的一个重要优点是，除了假设其无源性之外，无需精确建模所考虑的环境即可证明稳定性。换句话说，对特定类型的环境没有限制，而这在力控制器的稳定性证明中通常是假定的 (Wen and Murphy, 1990; Jung et al., 2004)。事实上，假设环境相对于 (x˙,−Fext​) 对是无源的就足够了，参见 Ott (2007) 中的类似论证。非无源环境向系统注入能量，因此可能使其不稳定。这必然意味着：

S˙env​≤−x˙TFext​(14)  
成立，其中 Senv​ 是与无源环境相关的正定存储函数。

**4.1.2. 力-阻抗控制的刚性机器人**

**4.1.2.1. 跟踪。** 考虑 (1)、(8)、(9) 和 (10)，机器人在笛卡尔坐标系中的动力学模型变为：

MC​(q)x¨+CC​(q,q˙​)x˙+Fg​(q)=J\#T(q)τm​+Fext​(15)  
将 τm​ 替换为 (13)，闭环动力学方程变为：

MC​(q)x¨+CC​(q,q˙​)x˙+Fg​(q)=KC​x\~+DC​x\~˙+MC​(q)x¨d​+CC​(q,q˙​)x˙d​+Fg​(q)+Ff​+Fext​(16)  
因此：

MC​(q)x\~¨+CC​(q,q˙​)x\~˙+DC​x\~˙+KC​x\~+Ff​+Fext​=0(17)  
令 (17) 的存储函数定义为：

Si,r​:=21​x\~˙TMC​(q)x\~˙+21​x\~TKC​x\~(18)  
然后，考虑 (17)，很容易看出存储函数 (18) 的时间导数为：

S˙i,r​=x\~˙TMC​(q)x\~¨+21​x\~˙TM˙C​(q,q˙​)x\~˙+x\~˙TKC​x\~=x\~˙T(−Ff​−Fext​−CC​(q,q˙​)x\~˙−DC​x\~˙−KC​x\~)+21​x\~˙TM˙C​(q,q˙​)x\~˙+x\~˙TKC​x\~=−x\~˙T(Ff​+Fext​)−x\~˙TDC​x\~˙+21​x\~˙T(M˙C​(q,q˙​)−2CC​(q,q˙​))x\~˙=x˙TFext​−(x\~˙TDC​x\~˙+x˙TFf​−x˙dT​(Ff​+Fext​))≥0(19)  
其中考虑了 (MC​(q,q˙​)−2CC​(q,q˙​)) 的斜对称性。 xTFf​ 和 x˙dT(Ff​+Fext) 的符号是先验未知的，并且为相对端口定义适当的存储函数是不可行的。因此，无法保证相对于 (x˙,Fext​) 的无源性。

**4.1.2.2. 调节。** 对于柔顺控制 (12)，闭环动力学 (17) 变为：

MC​(q)x¨+CC​(q,q˙​)x˙+DC​x˙=KC​x\~+Ff​+Fext​(20)  
存储函数为：

Sc,r​:=21​x˙TMC​(q)x˙+21​x\~TKC​x\~(21)  
其时间导数为：

S˙c,r​=x˙TMC​(q)x¨+21​x˙TM˙C​(q,q˙​)x˙+x\~˙TKC​x\~=x˙TFext​−(x˙TDC​x˙+x˙TFf​)(22)  
由于 (22) 中的项 x˙TFf​，无法保证整体无源性。

**4.2. 能量箱增强：力控制器**

为了解决无源性违反问题，应用了虚拟能量箱的概念。随后的概念和证明遵循我们提出的 Schindlbeck 和 Haddadin (2015) 和 Shahriari et al. (2018) 中的类似思路。首先，我们为力控制器引入虚拟能量箱，即针对端口 (x˙,Ff​)。其能量定义为 Tf​=1/2xtf2​，其中 xtf​=0 表示其状态，其动力学为：

x˙tf​=xtf​βf​​γf​x˙TFf​+xtf​af​​(γf​−1)x˙TFf​(23)  
其中 γf​ 定义为：

γf​={10​x˙TFf​\<0else​(24)  
请注意，还可以将 γf​ 进一步细分为向量 γf​=\[γp​,γi​,γd​,γFF​\]T，使得每个元素对应于力控制器的某个特定分量。然而，考虑到 x 是与 Ff​ 对应的流，将单个变量 γf​ 与功率 x˙TFf​ 相关联更具解释性。如果达到某个上限存储 Tu,f，则通过以下方式防止能量箱过载：

βf​={10​if Tf​≤Tu,felse​(25)  
最后，虽然 af​ 可以简单地定义为二进制信号，但为了平滑从填充到排空的过渡， af​ 选择为：

af​=⎩⎨⎧​121​\[1−cos(δT,f​Tf​−TL,f​​π)\]0​if Tf​≥TL,f​+δT,f​if TL,f​+δT,f​≥Tf​≥TL,f​else​(26)  
其中 TL,f​\>0 是能量箱的下限。因此，af​ 负责在能量箱能量超过 TL,f​+δT,f​ 后平稳地分离能量箱。它在某个阈值 δT,f​≥0 后衰减到零，并在 Tf​ 达到 TL,f​ 时保持为零。因此，能量箱的能量水平始终保持在能量箱下限之上。实际上，这种平滑行为避免了能量箱的突然断开，这可能导致机器人运动中出现不必要的瞬时变化。刚体和柔性关节机器人力控制器的最终控制律变为：

τf′​=uf′​=JT(q)Ff′​(27)Ff′​=(γf​+αf​(1−γf​))Ff​(28)  
这个控制器只在最小级别上介入，即只有当 (i.) 能量箱为空且 (ii.) 任务在无源性意义上表现活跃时，任务才会降级。

**4.2.1. 注意。** (23)-(28) 的整个设计也可以用 q˙​ 和 τf​ 代替 x˙ 和 Ff​ 来完成。随后的分析也将类似。

**4.3. 能量箱增强：阻抗控制器**

遵循与力控制器相同的方法，为端口 (x˙d,−(Ff′​+Fext)) 定义第二个能量箱。能量箱能量定义为 Ti​=1/2xti2​，其中 xti​ 是能量箱状态，其动力学为：

x˙ti​=xti​βi​​(γi​x˙dT​(Ff′​+Fext​)+x\~˙′TDC​x\~˙′)+xti​ai​​(1−γi​)x˙dT​(Ff′​+Fext​)(29)x\~˙′=(γi​+ai​(1−γi​))x˙d​−x˙(30)  
这里，γi​ 定义为：

γi​={10​if x˙dT​(Ff′​+Fext​)\>0else​(31)  
注意与力箱相反的切换符号。此外，βi​ 和 αi​ 定义为：

βi​={10​if Ti​≤Tu,ielse​(32)  
和：

ai​=⎩⎨⎧​121​\[1−cos(δT,i​Ti​−TL,i​​π)\]0​if Ti​≥TL,i​+δT,i​if TL,i​+δT,i​≥Ti​≥TL,i​else​(33)  
其中 Tu,i≥0 和 TL,i​\>0 分别是能量上限和下限，δT,i​ 是为能量箱能量下限设计的阈值。通过增强虚拟能量箱，期望速度相应地修改为：

x˙d′​=(γi​+ai​(1−γi​))x˙d​(34)  
虽然期望加速度 x¨d′​ 可以通过对速度 x˙d′​ 进行直接微分来获得，但正确识别控制器设定点至关重要。设定点的平移分量可以通过简单地积分速度来确定。然而，当涉及到旋转部分时，必须考虑角速度与姿态时间导数之间的差异 (Gallego and Yezzi, 2015)。阻抗控制器 (6) 然后调整为：

τi′​=JT(q)\[KC​x\~′+DC​x\~˙′+MC​(q)x¨d′​+CC​(q,q˙​)x˙d′​\]+g(q)(35)  
其中 x\~′=xd′​−x。

**4.4. 最终基于无源性的力-阻抗控制器**

考虑 (27) 和 (35)，刚体机器人的基于无源性的笛卡尔力-阻抗控制器是：

τm′​=τi′​+τf′​(36)  
图 2 描绘了带有能量箱的完全细化的统一控制器的概览。

图 2\. UFIC 的力和阻抗能量箱架构。

**4.5. 能量箱增强后的无源性分析**

通过新的控制器设计，整个系统的存储函数变为：

Stot,r​:=Si,r​+Tf​+Ti​=Si,r​+21​xtf2​+21​xti2​(37)  
考虑 (23) 和 (29)，总能量箱能量 T 的时间演变是：

T˙=xtf​x˙tf​+xti​x˙ti​=−βf​γf​x˙TFf​+af​(γf​−1)x˙TFf​+βi​(γi​x˙dT​(Ff′​+Fext​)+x\~˙′TDC​x\~˙′)+ai​(1−γi​)x˙dT​(Ff′​+Fext​)(38)  
因此，考虑 (19) 我们得到：

S˙tot,r​=x˙TFext​−x\~˙′TDC​x\~˙′+x˙TFf′​−x˙d′T​(Ff′​+Fext​)−βf​γf​x˙TFf​+αf​(γf​−1)x˙TFf​+βi​(γi​x˙dT​(Ff′​+Fext​)+x\~˙′TDC​x\~˙′)+ai​(1−γi​)x˙dT​(Ff′​+Fext​)=x˙TFext​−x\~˙′TDC​x\~˙′+(γf​+af​(1−γf​))x˙TFf​−(γi​+ai​(1−γi​))x˙dT​(Ff′​+Fext​)−βf​γf​x˙TFf​+af​(γf​−1)x˙TFf​+βi​γi​x˙dT​(Ff′​+Fext​)+βi​x\~˙′TDC​x\~˙′+ai​(1−γi​)x˙dT​(Ff′​+Fext​)=x˙TFext​+(βi​−1)x\~˙′TDC​x\~˙′+γf​(1−βf​)x˙TFf​+γi​(βi​−1)x˙dT​(Ff′​+Fext​)(39)  
根据 γf​ 和 γi​ 的值，S˙tot,r​ 将有四种情况，参见表 2。对于所有情况，S˙tot,r≤x˙TFext 都成立。因此，整个系统始终对 (x˙,Fext​) 无源。

表 2\. 考虑 (24)、(31) 和 (39) 的不同能量箱值下刚体机器人情况的存储函数时间导数。

| γf​ | γi​ | S˙tot,r​ |
| :---- | :---- | :---- |
| 1 | 1 | \<0 |
|  |  | (−1)x˙T(Ff​+Fext​)+(1−βi​)x˙TDC​x˙+(1−βf​)x˙TFf​+x˙TFext​≤x˙TFext​ |
| 1 | 0 | x˙TFext​+(βi​−1)x˙TDC​x˙≤x˙TFext​ |
|  |  | x˙TFext​+(βi​−1)x˙dT(Ff′​+Fext)≤x˙TFext​ |
| 0 | 1 | ϵ(−1,0)(βi​−1)​20x˙TDC​x˙​+ϵ(0,1)(1−βf​)​≤0x˙TFf​​+x˙TFext​≤x˙TFext​ |
|  |  | $ \\frac{(\\beta\_i-1)}{\\epsilon(-1,0)}\\frac{\\dot{x}^{\\prime T} D\_C\\dot{x}^{\\prime T}}{20}+\\frac{(\\beta\_i-1)}{\\epsilon(-1,0)}\\frac{\\dot{x\_d^{T}(F\_f^{\\prime}+\\overline{F}*{ext})}{20}+\\dot{x}^T F*{ext}\\le\\dot{x}^T F\_{ext} $ |
| 0 | 0 | ϵ(−1,0)(βi​−1)​20x˙′TDC​x˙′T​+x˙TFext​≤x˙TFext​ |
|  |  | x˙TFext​+(βi​−1)x˙dT(Ff′​+Fext)≤x˙TFext​ |

因此，考虑 (14)，整个系统与无源环境的结合导致一个存储函数为 (Stot,r​+Senv​) 的无源系统，使得 S˙tot,r+S˙env≤0.

**4.5.1. 注意。** 根据任务，期望力矩 Fd​(t) 和运动 xd​(t) 可以在不同的笛卡尔坐标系中定义。在这种情况下，不仅用于推导 (4) 和 (7) 中控制误差的信号应该与期望值定义在相同的坐标系中，而且在 (3)、(6) 和 (8) 中也应该使用适当的雅可比矩阵来构造控制输入。因此，所有上述推导，以及无源性证明，仍然成立，因为功率和能量是与坐标无关的项。

**4.6. 通过 Lyapunov 函数进行稳定性分析**

让我们将整个系统的状态变量定义为：z=\[x\~′T,x\~˙′T,xtf​,xti​,xenvT​\]T，其中 x\~′=xd′​−x，xenv​∈R6 是环境状态，由此确定环境的能量 Senv​∈R≥0​。此外，考虑 xtf,​xti∈​R≥0​ 和 xenv∗​∈R6，使得：

∀z∈X\\{\[0T,0T,xtf∗​,xti∗​,xenv∗​\]T}21​x\~′TKC​x\~′+21​x\~˙′TMC​(q)x\~˙′+Tf​(xtf​)+Tf​(xti​)+Senv​(xenv​)\>Tf​(xtf∗​)+Tf​(xti∗​)+Senv​(xenv∗​)(40)  
其中 X 是控制任务期间 z 的所有可能值的空间。在下文中，我们表明整个系统在 z^=\[0^T,0^T,x\_{tf}^,x\_{ti}^,x\_{env}^\]^T 处是稳定的。候选 Lyapunov 函数是：

V(z)=21​x\~′TKC​x\~′+21​x˙′TMC​(q)x\~˙′+21​xtf2​+21​xti2​+Senv​(xenv​)−21​xtf∗2​−21​xti∗2​−Senv​(xenv∗​)(41)  
可以看出 V(z∗)=0，考虑到 (40)：

∀z\\z∗,V(z)\>0(42)  
因此，考虑到 (41) 的连续可微性，V(z) 是一个有效的 Lyapunov 函数。此外，考虑到 (14) 和表 2：

V˙(z)≤0(43)  
因此，整个系统在 \[x\~′T,x\~˙′T,xtf​,xti​,xenvT​\]T=\[0T,0T,xtf,​xti,​xenv∗​\] 处是 Lyapunov 稳定的。请注意，由于总是可以假设环境中存在耗散，因此可以说 S˙env​\<0，从而导致：

V˙(z)\<0(44)  
因此，在这种假设下，整个系统变得渐近稳定。

在 z=z∗ 处实现控制目标取决于 xtf∗​ 和 xti∗​ 的值。考虑到 (33)，如果 xti∗​≥2(TL,i​+δT,i​)​，则在 z=z∗ 时 αi​ 的值为 1，这意味着 x,x˙ 分别收敛到 xd​,x˙d​。相反，对于 αi​\<1 的情况，期望轨迹被修改为 xd′​(t)，因此 x,x˙ 将分别收敛到整形后的 xd′​,x˙d′​。将 z=z∗ 视为系统的稳定平衡点，闭环动力学方程 (17) 变为：

Ff′​+Fext​=0(45)  
请注意，在 z=z∗ 处，环境状态 xenv​ 将不再发生变化，即 x˙env​=0，从而导致 S˙env​=0。因此，外部力矩 Fext​ 在 z∗ 处可以假定为常数。这意味着考虑到 (45)，Ff′​ 也将在 z=z∗ 处收敛到一个常数值。现在，考虑到 (4) 中没有前馈力矩（即 FFF​=0），如果在 z∗ 处 αf​ 的值为 1（即 xtf∗​≥2(TL,f​+δT,f​)​），则 Ff′​ 将等于 Ff​，(45) 变为：

Kp​F\~+Kd​F\~˙+Ki​∫t∗t​F\~dσ+Fext​=0(46)  
其中 F\~=Fd​+Fext​，t∗ 是 z 收敛到 z∗ 的时间。

**4.6.1. 无源性缓冲。** 只要控制器和能量箱作为一个组合系统表现出无源性，力控制器 (46) 就以其自身的动力学收敛到 Fd​=−Fext​（显然假设这个或任何其他合适的力控制器确实能够自行收敛）。本质上，无源性缓冲意味着 (i.) 一个可能非无源的控制器被能量箱安全缓冲增强，并且 (ii.) 它们共同为整个系统提供了更大的收敛空间。

**4.6.2. 无源性违反。** 如果无源性缓冲内的控制器系统表现出非无源性，它将平稳地与整个系统分离，以免违反整体稳定性。在这种情况下，Ff′​ 将逐渐从 Ff​ 偏离到 0，并且力控制目标将为了稳定性而牺牲。

**5\. 控制器初始化**

为清晰起见，省略了期望扭曲和力矩的时间依赖性。此外，为保持简洁，我们仅提供了不同坐标系中类别 1、2A 和 2B 的一个示例。

通过增强虚拟能量箱，可以克服力控制和运动控制需要专属互易空间的传统规则。然而，当力矩和速度（扭曲）共享非正交分量时，仍然存在两个主要问题。

首先，在同一方向上实现交互力矩和运动的任意值通常是不可行的 (Hogan, 1984)。因此，需要折衷其中一个目标以实现另一个目标，或者通常选择使其与主要目标固有地一致。例如，可以通过合适的控制器参数化来完成此过程，以优先考虑一个控制目标而不是另一个。

其次，即使连接了能量箱，仍然可能发生潜在的无源性违规动作，即运动中的力控制和接触中的运动控制。这些动作的程度取决于能量箱可以提供的能量量。因此，出现一个设计问题：能量箱应该保留和提供多少能量？

在解决这两个挑战之前，让我们首先检查可能导致非正交力和运动的最相关场景。

如前所述，同时控制力和运动的常见方法是在受约束方向上控制力，而在非受约束方向上控制运动。然而，这需要在在线获取环境的精确几何模型。由于没有模型是完全没有误差的，并且环境变化（例如由于与机器人的持续交互）可能导致模型差异，因此实际的几何模型不太可能与定义力控制器和运动控制器的坐标相匹配。因此，即使任务在互易空间中定义，也会在力控制方向上发生运动，并在运动控制方向上发生力矩。此外，即使拥有完美的环境几何模型，环境的动力学也可能导致非正交的力和运动分量。一个经典的例子是表面摩擦。即使运动控制在无约束方向上指定，摩擦也会固有地在运动方向上引起过程力矩。类似地，柔顺表面导致在施加力矩的方向上产生运动。在下文中，提出了解决这些场景的实用建议。

**5.1. 任务参数化**

为了确保力控制和阻抗控制在互易空间中运行，不仅要定义正交的期望运动和力矩，还要正确设置相关的控制器参数。具体而言，参考 (6)，与受约束方向相关的刚度和阻尼矩阵 KC​、DC​ 的元素应设置为 0。此外，力控制器律 (4) 中与无约束方向相关的反馈和前馈项 Kp​、Kd​、Ki​、FFF​ 的元素也应设置为零。

随后，力-阻抗控制任务根据不同表面类别施加的运动学约束进行分类如下：

* **类别 1：** 无约束点接触（例如，锉削、压痕、按钮推动）  
* **类别 2A：** 无约束表面接触（例如，螺丝拧紧、抛光或研磨 2D 表面）  
* **类别 2B：** 半约束表面接触（例如，抛光或研磨 3D 表面）  
* **类别 2C：** 约束表面接触（例如，对接操作）

表 3 列出了这些四种表面类别的 UFIC 控制输入 Fd​(t) 和 x˙d​(t) 的有效任务变量组合。此处，Fp​∈R6 表示由于在表面上的运动控制动作而产生的环境过程力矩，详情如下所述。

表 3\. UFIC 任务变量配置和接触反作用模型。

| 类别 | 期望扭曲 | 期望力矩 | 过程反作用力矩模型 |
| :---- | :---- | :---- | :---- |
| 1 | $\\begin{bmatrix} \\dot{v}*{d,x} & \\dot{v}*{d,y} & 0 \\end{bmatrix}^T $$ \\begin{bmatrix} \\omega\_{d,x} & \\omega\_{d,y} & \\omega\_{d,z} \\end{bmatrix}^T $ | $\\begin{bmatrix} 0 & 0 & f\_{d,z} \\end{bmatrix}^T $$ \\begin{bmatrix} 0 & 0 & 0 \\end{bmatrix}^T $ | $\\begin{bmatrix} f\_{p,x} & f\_{p,y} & f\_{d,z} \\end{bmatrix}^T $$ \\begin{bmatrix} 0 & 0 & 0 \\end{bmatrix}^T $ |
| 2A | $\\begin{bmatrix} \\dot{v}*{d,x} & \\dot{v}*{d,y} & 0 \\end{bmatrix}^T $$ \\begin{bmatrix} 0 & 0 & \\omega\_{d,z} \\end{bmatrix}^T $ | $\\begin{bmatrix} 0 & 0 & f\_{d,z} \\end{bmatrix}^T $$ \\begin{bmatrix} m\_{d,x} & m\_{d,y} & 0 \\end{bmatrix}^T $ | $\\begin{bmatrix} f\_{p,x} & f\_{p,y} & f\_{d,z} \\end{bmatrix}^T $$ \\begin{bmatrix} m\_{d,x} & m\_{d,y} & m\_{p,z} \\end{bmatrix}^T $ |
| 2B | $\\begin{bmatrix} \\dot{v}\_{d,x} & 0 & 0 \\end{bmatrix}^T $$ \\begin{bmatrix} 0 & 0 & 0 \\end{bmatrix}^T $ | $\\begin{bmatrix} 0 & f\_{d,y} & f\_{d,z} \\end{bmatrix}^T $$ \\begin{bmatrix} m\_{d,x} & m\_{d,y} & m\_{d,z} \\end{bmatrix}^T $ | $\\begin{bmatrix} f\_{p,x} & f\_{d,y} & f\_{d,z} \\end{bmatrix}^T $$ \\begin{bmatrix} m\_{d,x} & m\_{d,y} & m\_{d,z} \\end{bmatrix}^T $ |
| 2C | $\\begin{bmatrix} 0 & 0 & 0 \\end{bmatrix}^T $$ \\begin{bmatrix} 0 & 0 & 0 \\end{bmatrix}^T $ | $\\begin{bmatrix} f\_{d,x} & f\_{d,y} & f\_{d,z} \\end{bmatrix}^T $$ \\begin{bmatrix} m\_{d,x} & m\_{d,y} & m\_{d,z} \\end{bmatrix}^T $ | $\\begin{bmatrix} f\_{d,x} & f\_{d,y} & f\_{d,z} \\end{bmatrix}^T $$ \\begin{bmatrix} m\_{d,x} & m\_{d,y} & m\_{d,z} \\end{bmatrix}^T $ |

如前所述，即使力控制和运动控制任务被设计为互易的，模型差异也可能导致无源性违反。这种差异并非总是不故意的。在某些情况下，当环境具有复杂的几何形状时，采用简化的模型来构建任务坐标可能更实用。例如，当表面曲线不断变化时，假设为直线平面表面可能是一种合适的方法。在这种情况下，一种实用的方法是增加阻抗控制的柔顺性，即在控制力或控制运动都不关键的方向上减小刚度和阻尼值。通过这样做，我们允许机器人的末端执行器适应表面（参见第 7.4 节中的示例）。在这种情况下，将力控制任务定义在末端执行器坐标系中可能更合理，以确保被动行为。然而，如果由于高柔顺性导致末端执行器姿态发生变化，这种方法可能导致非正交的力控制和运动控制任务。为了解决这种情况，应实施合适的增益结构，编码在给定方向上力控制或运动控制应优先。一种常见的方法是通过使用相对较高的积分器反馈增益来优先考虑力控制器 (Villani and Schutter, 2016)。

除了环境运动学模型外，以摩擦、粘弹性、磨损行为甚至切换交互动力学为特征的过程动力学也具有显著影响。这些效应可以通过明确考虑预期的过程力矩（表示为 Fp​）来解决，这包括例如与表面摩擦相关的力矩或机器人正在推动的物体的动态效应。补偿这些效应的一种方法是在力控制 (4) 中使用前馈项 FFF​。如下文所示，这可以直接影响虚拟能量箱的行为。

**5.2. 能量箱初始化**

尽管稳定性已得到证明，但这并不一定意味着可以按预期完成任务。如果任何一个能量箱没有加载足够的能量，力控制器将被停用，或者阻抗控制将转换为柔顺控制。如果这在操纵过程中发生，由于无法相应地调节力矩或未能正确遵循期望轨迹，预期的任务目标将无法实现。为了解决这个问题，Haddadin (2015); Schindlbeck 和 Haddadin (2015) 引入了初始任务能量 ET​ 的概念。 ET​ 定义为最初必须存储在能量箱中的最小能量，以满足操纵任务的所有要求。如果不仅要实现稳定性，还要实现正确的任务执行和性能，则必须在执行前知道此任务能量或至少其估计下限。显然，最简单的策略是使用一个实际足够高的能量量。然而，由于所提供的能量用于潜在的无源性违反动作，例如运动中的力控制和接触中的运动控制，优先考虑安全建议避免能量箱过载。因此，应寻求一种方法来估计虚拟能量箱所需的最小初始能量。该估计可以基于任务或环境模型。或者，随着机器学习的最新进展，可以使用数据驱动或模型知情的混合方法。例如，在 Shahriari et al. (2019) 和 Benzi et al. (2022) 中，引入了两种适应能量箱配置的方法，这在环境发生变化时特别有用。在本研究中，我们提出了一种通用的基本情况策略，用于系统地初始化 UFIC 的能量箱，为未来的基于学习的初始化方法奠定了基础。在下文中，我们提出了几种基于模型的能量箱初始化方法。

**5.2.1. 力控制能量箱。** 为了确定力控制能量箱中最初需要多少能量才能完成任务，让我们首先考虑能量箱能量会被耗尽的场景。如第 4.2 节所述，这些场景发生在功率 x˙TFf​ 大于零时，即当力控制和机器人运动方向相同时。这种情况为真的一个场景是，在机器人尚未接触时激活力控制，导致机器人在力控制方向上加速。类似地，这种情况的另一个场景是，当力控制处于激活状态时，接触丢失。另一个场景发生在接触表面具有弹性时，因此机器人穿过表面以建立期望的力矩。由于前两种场景是故障情况，我们重点关注第三种情况，并假设前两种场景通过适当的措施（例如第 6 节中的接触丢失稳定）来处理。让我们首先考虑以下假设下的平移情况。

**假设 1\.** 机器人精确执行所需的线性力控制任务，使其完全由表面反作用力和力矩补偿，即 Fw​=Fd​(t) 和 Mw​=Md​(t)。

为简单起见，环境假定为线性弹性，在这种情况下，结合假设 1，得到：

Fd​(t)≈Fw​=Kw,t​(Pw​(t)−Pw,0​)(47)  
其中 Fw​ 被建模为一个具有初始位置 Pw,0​ 的线性刚度壁 Kw,t​。解出 Pw​(t)=Kw,t−1​Fd​(t)+Pw,0​ 得到移动壁所需的功为：

ET,f​(t)=∫0t​21​(Pw​(σ)−Pw,0​)TKw,t​(Pw​(σ)−Pw,0​)dσ(48)  
对于调节情况，方程 (48) 简化为：

ET,fl​=21​(Pw​−Pw,0​)TKw,t​(Pw​−Pw,0​)(49)  
借助基于四元数的势函数 (Caccavale et al., 1998)：

ET,fq​=2kT​VKw,q​kV​(50)  
平移原理可以扩展到旋转情况。 k=(k0​,kv​):=kw,0−1​kw​ 定义了四元数旋转误差——其中标量部分为 k0​，向量部分为 kv​——从壁初始姿态 kw,0​=(k0,(w,0)​,kv,(w,0)​) 和平衡姿态 kw​=(k0,w​,kv,w​)。其中 Kw,q​ 是在四元数空间中定义的壁旋转刚度矩阵。请注意，在 SO(3) 上存在多个平衡点，其中只有一个是稳定的，即势函数只需在局部考虑。

最后，力控制能量箱可能被耗尽的另一个场景是由于前馈项 FFF​，当它用于处理环境动力学效应时，例如前馈摩擦补偿。在这种情况下，前馈项将与运动控制方向共线。为了估计相关的能量，一种方法是建模预期的摩擦。由于将在阻抗控制能量箱初始化过程中使用类似分析，因此我们将在下一节中讨论这个问题。值得一提的是，为了避免将力控制能量箱能量用于此类目标，可以专门为前馈项设置一个单独的能量箱。无源性分析和能量箱增强过程将与用于力控制器的过程相同。然而，为清晰起见，本工作不遵循此做法。

**5.2.2. 阻抗控制能量箱。** 如第 4.3 节所述，与阻抗控制能量箱相关的功率是功率 x˙dT​Ff​ 和 x˙dT​Fext​ 的总和。

让我们首先讨论这些功率何时从无源性的角度来看变得有问题。条件 x˙dT​Ff​\>0 成立，如果期望运动与力控制输出相反，即当阻抗控制任务旨在抵消力控制器时。如前所述，这种情况可能发生的常见场景是两个控制器在两个独立的坐标系中定义，例如力控制器的末端执行器坐标系和阻抗控制器的世界坐标系。

为这些场景开发基于模型的方法需要考虑几个方面，包括环境的近似几何模型和期望运动的特征。然而，由于这些信息并非总是可用，虽然我们强调拥有能量箱来解决这些场景的重要性，但我们避免为它们的能量初始化过程设计基于模型的方法。

另一方面，x˙dT​Fext​\>0 成立，如果期望运动与环境反作用力矩相反。这可能有两个干扰原因：

* **干扰 1：** 由于意外障碍物或材料缺陷造成的夹紧。  
* **干扰 2：** 由于表面摩擦或被运载物体动力学效应造成的卡滞。

干扰 1 显然是意外故障，需要检测而不是处理。由于它直接与接触力相关，因此假设 r:=x˙dT​Ff​ 远远超出预期过程力而增加是合理的。因此，r 是一个有效的夹紧故障检测信号。另一方面，如果知道或学习了设计或实验中的最大卡滞力，则可以通过分配合理量的初始能量箱能量来考虑干扰 2。如果摩擦是干扰的主要原因，可以使用简单的模型来估计初始能量：

Ffrc​=dv​∘x˙w​+\[dcf​13×1​dcm​13×1​​\]∘sgn(x˙w​)(51)  
其中 ∘ 表示逐元素乘积运算，x˙w​∈R6 是接触表面速度，dv​∈R≥06​ 是粘滞摩擦系数向量， dcf​, dcm​∈R≥0​ 分别是线性和角库仑摩擦系数。它们可以表示为：

\[dcf​dcm​​\]=\[μff​μmf​​μfm​μmm​​\]\[∣∣fN​∣∣∣∣mN​∣∣​\](52)  
其中 fN​,mN​∈R3 分别是表面法向力和力矩。最后，为了估计初始阻抗控制能量箱能量，我们做以下假设。

**假设 2\.** 由于假设 1，可以得出 FN​(t)=\[fNT​,mNT​\]T≈Fd​(t)。

**假设 3\.** 由于机器人在静止接触下准确执行运动跟踪任务，我们假设 (51) 中 x˙w​≈x˙d​(t)。

在这些简单假设下——本质上，它们对应于假设 UFIC 正常工作——估计的初始阻抗能量箱能量变为：

ET,i​=∫0t​(∣x˙d​(σ)∣Tdc​(Fd​(σ))+x˙dT​(σ)(dv​∘x˙d​(σ)))dσ(53)  
仅需要知道表面摩擦特性 dv​ 和 μ。

显然，初始能量估计 (48) 和 (53) 必须根据当前特定的 UFIC 任务（即机器人正在处理的表面类别和期望运动）进行调整。表 3（最后一列）根据针对所有表面类别在局部接触坐标系中表达的描述估计，列举了过程反作用力矩。过程力矩 Fp​ 的元素可分为两组，如下所示。第一组由力控制结果产生的力矩组成。它们通常与阻抗控制期望速度互易。它们的大小等于期望力矩（假设 1）。第二组涉及由阻抗控制器期望速度产生的元素。它们代表接触表面速度 x˙w​ 方向上表面过程力矩 Fp​ 的非零元素，等于期望扭曲（假设 3）。它们是表面法向力矩的函数，这些力矩假定等于力控制器的期望力矩（假设 2）。因此，考虑表 3，(51) 中的摩擦力矩 Ffrc​ 对于表面类别 2A 具有三个维度，对于类别 1 和 2B 具有两个维度，对于类别 2C 则没有维度。

**5.3. 传感器误差对能量箱性能的影响**

到目前为止，我们假设可以访问准确感应或观察到的信号，例如 Fext​(t) 和 x(t)，用于我们的能量箱设计。然而，如果这些信号不准确，这种稳定性可能不成立。考虑一个场景，其中 Fext​ 与 Fext​ 不同。一个直接的后果是力控制输出 Ff​ 无效。仅此一项不会影响能量箱的性能。无论 Fext​ 的准确性如何，力控制能量箱都可以在 Ff​（一个可访问的值）启动运动时介入，并且它可能会停用力控制以保持稳定性。然而，这不适用于阻抗控制能量箱，它依赖于 Fext​ 的准确性。如果 Fext​ 不准确，系统可能无法确保稳定性。例如，考虑能量箱动力学 (29)，如果没有 Ff​（即在期望运动方向上没有力控制），并且尽管存在非零外部力矩 Fext​，但感应到的值 Fext​ 为零，则阻抗控制能量箱不会激活，因为相关的功率 x˙dT​Fext​ 为零。然而，实际上，x˙dT​Fext​ 非零，这可能导致整个系统不稳定。确保即使在存在传感器不准确的情况下也能保持稳定的一种方法是，确保与此类误差相关的能量是有限的。换句话说，应该确保可以将无源系统与传感器不准确相关联。

**6\. 接触丢失稳定**

接触丢失的一个典型必要而非充分条件是力控制方向上出现不必要的运动。原则上，在 UFIC 框架中处理此类行为可以通过能量箱设计来完成，如果，在接触丢失时，剩余的力控制能量箱能量足够低，以在所需的行程距离之前停止。然而，在现实中，考虑到能量箱必须同时满足许多目标，并且所有内容都必须在能量域中设计，这是复杂且不切实际的。

因此，我们采用了一种补充的基于状态的控制策略，以及派生的能量箱。这确保了力控制能量箱中的能量仅根据能量箱初始化程序使用，并能非常好地处理突然的接触丢失场景。

**6.1. 控制器整形函数**

我们解决接触丢失问题的方法围绕着 UFIC 的基本原则，即阻抗控制和力控制完全集成到一个统一的框架中。具体来说，其基本思想很简单，但非常有效：有效接触对应于笛卡尔阻抗偏转向量 x\~ 和力控制器的期望力矩 Fd​ 共线。扩展的控制器设计从函数值整形向量开始：

ρ:=\[ρt,x​(Δpx​)​ρt,y​(Δpy​)​ρt,z​(Δpz​)​ρr​(Δφ)​\]T(54)  
它包括平移和旋转分量。其平移部分定义为：

ρt,x​(Δpx​):=⎩⎨⎧​121​\[1+cos(dmax​∣∣Δpx​∣∣​π)\]0​if fdT​Δp≥0if fdT​Δp\<0∧∣∣Δpx​∣∣∈\[0,dmax​\]else​(55)  
同步旋转部分 ρr​(ψ) 为：

ρr​(Δφ):=⎩⎨⎧​121​\[1+cos(ψmax​Δφ​π)\]0​if mdT​k0​kv​≥0if mdT​k0​kv​\<0∧Δφ∈\[0,ψmax​\]else​(56)  
平移情况的整形函数 ρt,x​(Δpx​) 的构造使得当期望力 fd​ 和从当前位置到设定点的向量 Δp=pd​−p 在鲁棒性区域 dmax​ 内共线时，控制器的力部分处于活动状态，参见图 3（上排）。用户可以根据任务或应用选择 dmax​。类似地，构造旋转控制器整形函数 ρr​(Δφ)。为了避免奇异性，ρr​(Δφ) 基于四元数，参见第 5 节。旋转误差定义为 Δk=kd​k−1， Δφ:=2arccos(Δk0​)。用户定义的旋转鲁棒性区域可以指定为角度 ψmax​，其与四元数的标量分量通过 ψmax​=2arccos(k0,max​) 相关，参见图 3（下排）。

从稳定性角度来看，由于整形函数仅缩放组合力-阻抗控制器的力控制器部分，(28) 可以简单地重新定义为：

Ff′′​=(γf​+αf​(1−γf​))Ff′​=(γf​+αf​(1−γf​))ρ∘Ff​(57)  
因此，再次确保了稳定性。ρ 的乘法是逐分量理解的，并且可以以类似的方式进行第 4 节中概述的带有能量箱的系统的无源性分析。整体 UFIC 控制系统的框图如图 4 所示，适用于刚性关节和柔性关节情况。

**6.2. 软材料讨论**

总的来说，所提出的接触丢失整形通过系统地耦合力控制和阻抗控制的优点，避免了突然和不安全的行为。鲁棒区域还为用户提供了直观可解释的设计变量，以塑造当前任务的整体行为。

图 3\. 左列：具有平移（上）或旋转（下）鲁棒区域 dmax​ 或 ψmax​ 的阻抗控制机器人。右列：平移（上）和旋转（下）情况的控制器整形函数。

请注意，在跟踪与软材料接触的期望力时，机器人可能会越过阻抗控制器设定点，尽管它仍处于接触状态。结果，整形函数将减小力控制器的作用。这表明不仅能量箱的能量应该被初始化和调整，而且 dmax​ 和 ψmax​ 也应该被初始化和调整。设计和学习过程显然需要正确反映环境的刚度和阻尼，以便整形函数在接触丢失之前不会不必要地停止力控制器。然而，这方面超出了当前工作的范围，需要未来的分析。

**7\. 实验**

为了进行实验验证，我们使用 Franka Emika 机器人 (Haddadin et al., 2022\) 进行了六个实验 A-F。在我们的实验实现中，使用了系统 1 kHz 快速控制接口 (FCI) 的内置外部力 Fext​ 测量。实验 1-5 和 7 用于分析力控制性能，而实验 6 则研究力矩控制性能。对于前者，使用羊毛覆盖的 3D 打印板进行抛光，对于后者，将金属锉刀安装到末端执行器上，参见图 5。所使用的控制器参数可在表 4 中找到。需要强调的是，对于力控制律 (4)，我们没有使用前馈项（即 FFF​=0）。此外，力矩控制中不打算控制力矩的方向对应的 Ff​ 元素乘以零。笛卡尔阻尼 DC​ 的设计使得实现临界阻尼 (Albu-Schäffer et al., 2003)。

**7.1. 实验 1：控制接触和运动——抛光**

在第一个实验中，任务是控制法向力并执行正交运动，例如抛光桌子。在阶段 1 中，通过简单的阻抗控制建立接触。然后，在阶段 2 中，激活 UFIC 控制以施加特定的期望力，并在阶段 3 中，在桌面平面上进行圆形运动。

图 6 描绘了 z 方向的力误差、阻抗控制能量箱 Ti​ 和力控制能量箱 Tf​ 的相应能量，以及末端执行器 x 和 y 位置。显然，由于 z 方向的有效速度较低，力控制能量箱能量的变化可以忽略不计。考虑到能量箱动力学 (29)，由于期望力矩和运动空间是互易的，力控制输出对阻抗控制能量箱的能量水平没有影响。影响能量箱的其余功率值为 P1​:=FextT​x˙d​ 和 P2​:=x\~˙TDC​x\~˙。由于表面摩擦导致与期望速度相反的力矩， P1​ 导致能量箱能量下降。相反，P2​ 的二次性质有助于能量箱能量持续增加。鉴于控制器临界阻尼的影响比表面摩擦更显著，最终 P2​ 将对能量箱能量水平的变化产生更主导的影响。因此，与阻抗控制阻尼相关的功率，反过来，在阶段 3a 的抛光运动期间填充阻抗控制能量箱。当能量箱能量达到上限时，限位键 βi​ 设置为零。然而，这并没有改变控制器的行为，如阶段 3b 所示。总的来说，任务执行准确且鲁棒。此外，在动态抛光运动期间，力控制误差保持在 ≈1 N。值得注意的是，如果功率 P2​ 不存在，成功的任务性能将需要确保能量箱的能量超过功率 P1​ 消耗的能量。鉴于 P1​=FextT​x˙d​ 和我们实验前对 x˙d​ 的先验知识，我们可以估计 Fext​ 用于此类能量计算。如第 5 节中广泛讨论的，这种估计可以通过建模表面摩擦和系数来实现。我们模型的准确性将直接影响我们能量耗散估计的精度。然而，由于固有的模型误差，一种实用的方法是确保能量盈余超过预测量。在随后的章节中，我们将演示一个实验，说明能量箱中能量不足的后果。

图 4\. UFIC、机器人系统（刚体和柔性关节）和无源环境的框图。

表 4\. 实验增益和参数。

| fd,z (N) | md,y (Nm) | KC \[N/m, Nm/rad\] | Kp | Kd | Ki | Tl,f (J) | Tu,f (J) | Tl,i (J) | Tu,i (J) |
| :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- |
| 实验 1 | 25 | \- | diag{3000,3000,100,300,300,300} | 1I6×6 | 0I6×6 | 2.5I6×6 | 0.01 | 20 | 0.01 |
| 实验 2 | 30 | \- | diag{3000,3000,100,300,300,300} | 1I6×6 | 0I6×6 | 2.5I6×6 | 0.01 | 20 | 0.01 |
| 实验 3 | var | \- | diag{3000,3000,100,300,300,300} | 1I6×6 | 0I6×6 | 2.5I6×6 | 0.01 | 20 | 0.01 |
| 实验 4 | 15 | \- | diag{3000,3000,10,0,50,300} | 1I6×6 | 0I6×6 | 4I6×6 | 0.01 | 20 | 0.01 |
| 实验 5 | 25 | \- | diag{3000,3000,10,0,50,300} | 1I6×6 | 0I6×6 | 4I6×6 | 5 | 20 | 0.01 |
| 实验 6 | \- | 1 | diag{3000,3000,3000,300,0,300} | 1I6×6 | 0I6×6 | 2.5I6×6 | 0.01 | 20 | 0.01 |
| 实验 7 | 12 | \- | diag{500,500,0,80,80,80} | 1I6×6 | 0I6×6 | 0I6×6 | 0.01 | 20 | 0.01 |

图 5\. Franka Emika 机器人的实验设置。

**7.2. 实验 2：鲁棒性——接触丢失**

为了展示如何处理第 6 节中描述的意外接触丢失，将末端执行器放置在桌子上，并在阶段 A 中控制其施加与之前实验相同的期望力。同时，在 x 方向上命令恒定速度，导致向桌面边缘移动，直到接触丢失。图 7 描绘了实验的不同阶段，图 8 显示了力误差、力控制能量箱 Tf​ 的能量水平、根据 (55) 的整形函数 ρt,z​，以及末端执行器位置 z。

实验针对两种参数化进行。在第一种情况下，整形函数以 dmax​=0.05 m 激活。如阶段 B 中所示，接触丢失后，ρt,z​ 从 1 平滑地减小到 0。反过来，尽管力误差上升到 ≈25 N，系统仍然稳定，并且末端执行器位置 z 停止。在期望力方向上的这个小运动导致力控制器能量箱的小能量下降。在第二种情况下，没有整形函数，在阶段 B 中，由于末端执行器在命令力方向上的高加速度，能量箱能量耗尽到较低水平，同时运动单调递减，即行为是不希望和危险的。显然，整形函数能够通过可编程安全屏障编码来缓解力控制中最具挑战性的问题之一。

图 6\. 实验 1：力误差、力和阻抗控制能量箱能量以及末端执行器位置，用于不同阶段的抛光任务：建立接触（阶段 1）、施加力（阶段 2）、同时抛光（阶段 3a）、阻抗控制能量箱填充（阶段 3b）。能量箱限制由绿色和红色虚线表示。

**7.3. 实验 3：力跟踪——带宽**

为了实验评估力跟踪带宽，使用频率增加的正弦波作为期望力，同时保持阻抗控制器设定点不变。图 9（上）显示了在不同频率下正弦波半周期的跟踪行为。此时间域图是通过连接不同实验在每个实验的几个周期后的结果而构建的。图 9（下）显示了在考虑和不考虑相位滞后情况下，针对不同频率测量的平均绝对误差。甚至可以在高达 3.2 Hz 的频率下实现高跟踪精度。对于高于机械系统带宽的更高频率，相位滞后开始导致显著的跟踪误差。

图 8\. 实验 2：x 方向运动（阶段 A），超出桌边运动（阶段 B）。

图 7\. 实验 2：接触丢失实验的阶段。

**7.4. 实验 4：在强干扰下控制接触和运动——铝制跷跷板**

为了展示 UFIC 控制下的机器人如何在未知环境中鲁棒地适应，即使在意外的强烈干扰和接触丢失下，也使用了跷跷板设置，参见图 10。环境未建模，我们也没有使用视觉系统或其他外部传感器来监测跷跷板状态。与实验 A 一样，任务目标是以恒定的法向力抛光表面；然而，在此实验中，表面并不总是水平的。为了解决这种干扰，虽然阻抗控制任务在世界坐标系中定义（例如，连接到桌子），但力控制任务在与机器人末端执行器对齐的坐标系中定义。此外，阻抗控制的旋转刚度设置为零（参见表 4），以使末端执行器——从而抛光板——被动地与表面对齐。结果，当阻抗控制器沿着桌子移动机器人时，力控制器对跷跷板表面施加垂直力矩。请注意，如第 4.5 节所述，力控制和运动控制之间的此类坐标不对齐不会违反稳定性证明。

实验过程如下，参见图 10。机器人从初始位置 ① 开始，在 x 方向上开始正弦抛光，并在 y 方向上进行线性运动。期望的设定点深度在桌面表面以下略微初始化。在运动过程 ② 中，末端执行器姿态通过将期望力矩调节到 md​=0 Nm，快速适应跷跷板几何形状中存在的倾斜。在越过跷跷板的未知自然平衡点和相应力阈值后，跷跷板突然倾斜 ③，机器人需要再次调节力和力矩。由于缺少反作用力以及冲击影响，这导致瞬时力偏差，在接触建立后和冲击动力学被抑制后，该偏差很快被消除。如阶段 ② 中已观察到的，机器人末端执行器适应跷跷板的倾斜 ④。相应的测量结果如图 11 所示。与实验 A 类似，抛光时力调节中出现小幅运动伪影。由于正弦轨迹仅在 x 方向上命令，因此这些误差的幅度小于实验 A。

**7.5. 实验 5：能量箱限制的影响**

为了显示能量箱能量不足的影响，在更动态的设置中，连续多次执行之前的实验。首先，能量箱下限从 0 J 增加到 5 J。其次，y 方向的期望速度高于之前，第三，施加更高的力，以便在实验过程中耗散更多的能量。查看图 12 可以看出，在第三次迭代（即 ③）中，t≈23 s 时，力控制器能量箱能量耗尽。这导致 αf​ 从 1 切换到 0。结果，力控制器被停用，力误差达到 25 N。在实践中，当在没有稳固接触的情况下施加力控制时，可能会发生期望力矩方向上的意外机器人运动。通过能量箱增强，我们限制了相关的能量，从而限制了这种潜在危险的运动。这在涉及接触丢失的场景中尤为重要，其中未能限制由此产生的机器人加速度可能导致不安全的冲击。同样的原理也适用于阻抗控制能量箱，因为期望轨迹穿透接触可能会产生显著的相互作用力矩，对机器人及其环境造成潜在危险。如本实验所示，能量箱有效地防止了此类情况的发生。

图 9\. 实验 3：在不同频率下的力跟踪性能，考虑实际值和期望值之间的时间滞后。

图 10\. 实验 4：跷跷板实验的阶段。正负号表示 y 方向的速度符号。跷跷板可以在其横向轴周围以低摩擦自由旋转。

**7.6. 实验 6：金属锉削**

最终实验侧重于旋转力矩的调节。为此，金属锉削应用作为一项真实世界评估任务，期望力矩 md​=1 Nm，参见图 13(a)。同时，在 y 方向上进行线性运动，并沿着 z 方向进行正交正弦运动，参见图 13(b)。因此，机器人——在调节期望力矩的同时——向金属件的边缘移动。同样，考虑了两种情况：有（阈值为 2°）和没有激活整形函数。在第一种情况下接触丢失后，整形函数平稳地停用力控制部分。对于第二种情况，机器人绕 y 轴进一步加速，再次导致不希望和危险的情况，参见图 13(c) 和 (d)。对于这两个实验，在阶段 (i) 期间，力矩几乎完美地调节，参见图 14。在相当快速的锉削过程阶段 (ii) 中，由于动态过程力，力矩误差增加。由于期望力矩方向上的运动可以忽略不计，能量箱能量没有显著变化。当在阶段 (iii) 接触丢失时，两种情况的力矩误差都达到 1 Nm。虽然带有整形函数的能量水平几乎保持不变，但没有整形函数的情况下能量持续耗尽。整形函数的效果也可以从方向图中观察到，因为观察到的振荡是由 z 方向运动的冲击引起的。

图 11\. 实验 4：力误差、阻抗和力控制能量箱能量以及末端执行器位置。

图 12\. 实验 5：力误差、力控制器能量箱能量和下限键以及末端执行器在 z 方向上的位置。

总而言之，UFIC 控制框架允许对力、力矩和运动进行鲁棒、安全和准确的同时控制，甚至允许在强过程干扰下进行极具挑战性的接触操作，例如锉削或抛光。值得注意的是，UFIC 框架已完全集成到 Franka Emika 机器人中。

**7.7. 实验 7：钥匙插入**

在本实验中，UFIC 框架用于一个孔槽任务，具体重点是插入钥匙到钥匙孔中（参见图 15）。实验设置开始时，机器人定位使得钥匙尖端与钥匙孔接触，但末端执行器的方向严重未对齐（图 15(a)）。因此，期望运动配置为保持静止位置，同时连续调整其方向（图 15(b)）。为了确定合适的方向，连续监测整形函数的输出。当此输出开始减小，表明对齐时，设定点方向被固定。在整个实验中，力控制以末端执行器 z 方向上 12 N 的目标力激活。此方向上阻抗控制的刚度设置为 0 N/m。当末端执行器方向与钥匙孔对齐后，力控制接合以引导钥匙进入孔中（图 15(c)）。图 16 说明了整个实验中每个变量的变化。请注意，这只是 UFIC 可以生成的众多解决方案之一。

图 13\. 实验 6：锉削实验的阶段。

其他策略可能涉及主动力模式或两者的组合，导致捅动型行为。

**8\. 结论**

由于性能、安全性和鲁棒性方面的限制，现有的力控制解决方案在实际应用中仍未成为一种商品控制方法。在本文中，我们引入了一个完整的基于无源性的笛卡尔力-阻抗控制框架，并集成了接触丢失稳定功能。据作者所知，这是第一个广泛使用的工业可用框架。

具体来说，我们允许刚体机器人和柔性关节机器人 (i.) 准确且鲁棒地调节和跟踪相互作用力，同时 (ii.) 安全地处理不可预见的接触不连续性。

前者是通过将增强的力控制和阻抗控制算法与两个不同的能量箱相结合来实现的。由于控制器的实际性能显著取决于虚拟能量箱的特定能量水平，因此引入了两种能量箱的能量初始化方法。这些基于模型的方法可以与我们之前提出的基于能量箱的能量学习方法 Shahriari et al. (2019) 相结合，以解决潜在的模型不准确问题。在我们即将进行的工作中，我们将重点关注这些方面的实际实施和评估。

后一种能力是通过一个基于位置的控制整形函数来实现的，该函数使用任务特定知识进行参数化，例如预期的表面曲率或允许的容差。这样，由于接触丢失而导致的不必要的快速运动就不会发生，同时也不会不必要地降低控制性能。

总而言之，我们的解决方案能够克服经典力控制和阻抗控制中仍然普遍存在的许多限制和相关问题。为了验证目的，我们使用最先进的关节扭矩控制触觉机器人进行了一系列特定实验。最重要的是，即使对于时变和不可预见的环境变化，我们的解决方案也能够在严重的进程干扰下实现复杂力调节和跟踪问题的高水平性能和鲁棒性。值得注意的是，我们已经成功地使用我们的框架解决了许多现实世界的工业制造和物流案例。我们还相信，空间、健康和家庭应用将从这项工作中大大受益。不久将要采取的重要一步是与合适的领域驱动（力-运动）策略算法的集成。这将最终使触觉机器人技术和策略学习更紧密地结合在一起，形成一个强大的解决方案，用于学习和执行复杂的操纵和交互任务。UFIC 框架的扩展还可能涉及协作任务，如我们在多手动物体提升/搬运的第一项工作中所示 (Shahriari et al., 2022)。最后，请注意，所开发的统一框架不需要机器人动力学模型。这些仅用于阻抗控制器。由于存在大量关于基于无源性的阻抗控制的工作，我们在此引用众所周知的工作 (Albu-Schäffer et al., 2007; Ott et al., 2008)，同时强调精确动力学模型对于高性能的必要性。在 UFIC 框架中，机器人动力学模型的未知部分可能被分配到有限但未公开的能量。因此，虽然这种不确定性肯定会以不希望的方式影响可实现的性能，但根据所提出的方法，整体系统仍然可以被证明是无源的。

图 14\. 实验 6：力误差、力控制器能量箱能量、整形函数和末端执行器绕 y 方向的姿态。

图 15\. 实验 7：持续调整期望姿态，直到钥匙成功插入钥匙孔。

**附录**

**附录：柔性关节机器人的 UFIC**

在本附录中，将 UFIC 框架扩展到柔性关节跟踪情况，这将允许应用于具有恒定关节阻抗的固有弹性系统。与刚性情况类似，所提出的系统通过增强前几节中设计的相同虚拟能量箱来保持无源性。

**8.1. 预备知识**

**8.1.1. 柔性关节动力学。** 对于轻量级或串联弹性执行器型系统，方程 (1) 不足以准确描述由于存在柔性传动而固有的动力学。齿轮（例如谐波传动齿轮）和集成关节扭矩传感器引起的关节弹性不可忽略，必须考虑在内。因此，对于此类结构，将考虑 Spong (1987) 中的（简化）柔性关节模型。它定义为：

M(q)q¨​+C(q,q˙​)q˙​+g(q)=τa​+τext​(58)Bθ¨+τa​=τm​(59)K(θ−q)+D(θ˙−q˙​)=τa​(60)  
其中 θ∈Rn 是电机位置。方程 (58) 和 (59) 分别构成了连杆侧和电机侧动力学。方程 (60) 通过弹性关节扭矩 τa​∈Rn 将 (58) 和 (59) 耦合起来，弹性关节扭矩被认为是具有线性粘弹性特性，即刚度和阻尼。矩阵 K,D,B∈Rn×n 是常数对角正定矩阵，分别表示集总关节刚度、阻尼和电机惯性。同样，不考虑摩擦效应，无论是在电机侧还是在连杆侧。

**8.1.2. 通过关节扭矩反馈进行惯性整形。** 配备关节扭矩传感的柔性关节机器人允许通过使用 Albu-Schäffer et al. (2004) 的控制律来整形电机惯性和关节阻尼：

τm​=Bθ−1​u0​+τa​+DKI−1​τ˙a​−Bθ−1​τa​+Dθ​KI−1​τ˙a​(61)  
其中 τ 是测量扭矩，并假设为：

τ=K(θ−q)(62)  
因此，可以写出 (59) 和 (60) 中的电机侧动力学以及关节动力学：

Bθ​θ¨+τa​=u(63)τa​=K(θ−q)+D(θ˙−q˙​)(64)  
系统由新的辅助控制输入 u 驱动，并且具有缩放的电机惯性 Bθ​ 和关节阻尼 Dθ​。由于这个物理可解释的低级回路已基本成为柔性关节控制的标准，因此方程 (63) 作为假定的关节级动力学。

**8.2. 控制设计**

**8.2.1. 笛卡尔力控制器。** 控制律采用与刚体情况相同的形式：

uf​=uf,p​+uf,i​+uf,d​+uf,FF​=JT(q)Ff​(65)  
其中：

uf,p​:=τf,p​uf,i​:=τf,i​uf,d​:=τf,d​uf,FF​:=τf,FF​  
**8.2.2. 笛卡尔阻抗控制器。** 最先进的柔性关节机器人笛卡尔阻抗控制 (Albu-Schäffer et al., 2007\) 仅在调节情况下被证明是无源的。为了进行无源性证明，控制器、电机和连杆侧动力学被分解。然而——如刚体机器人情况所示——对于轨迹跟踪任务，控制器和刚体机器人系统不应在无源性分析中分解。因此，在下文中，提出了一种用于柔性关节机器人的新型笛卡尔阻抗控制律，该律不依赖于上述分解假设。

为了推导柔性关节机器人的笛卡尔阻抗控制律，应考虑关节弹性。为此，首先注意关节弹性、阻尼和电机惯性的笛卡尔空间等效量：  
KθC​(q),DθC​(q),BθC​(q)∈R6×6.  
KθC​(q)=J\#T(q)KJ\#(q)(66)DθC​(q)=J\#T(q)Dθ​J\#(q)(67)BθC​(q)=J\#T(q)Bθ​J\#(q)(68)  
因此，考虑到 (63)-(64) 中关节弹性、阻尼以及电机惯性构成的总关节扭矩，每个项可以分别与笛卡尔空间对应关系等效：

K(θ−q)=JT(q)KθC​(q)(xθ​−x)(69)D(θ˙−q˙​)=JT(q)DθC​(q)(x˙θ​−x˙)(70)Bθ​θ¨=JT(q)BθC​(q)x¨θ​(71)  
其中 xθ​∈R6 是一个辅助变量，可以解释为笛卡尔空间中表示的电机坐标 θ。考虑 (66) 和 (69)， xθ​ 隐式定义为：

xθ​:=J(q)(θ−q)+x(72)  
假设 J˙(q)≈0，则有：

x˙θ​=J(q)θ˙(73)x¨θ​=J(q)θ¨(74)  
现在，考虑 (2)、(9)–(11)、(58)、(63)–(64) 和 (69)–(71)，笛卡尔空间柔性关节机器人动力学可以表示为：

KθC​(q)(xθ​−x)+DθC​(q)(x˙θ​−x˙)=MC​(q)x¨+CC​(q,q˙​)x˙+Fg​(q)−Fext​(75)  
如下文所述（参见第 8.3 节），与刚体情况不同，笛卡尔阻抗控制柔性关节机器人的目标闭环动力学必须包含由于关节弹性而产生的其他项，才能在跟踪情况下证明无源性。因此，我们提出以下闭环动力学。

MC​(q)x\~¨+CC​(q,q˙​)x\~˙+KC​x\~+DC​x\~˙θ​+BθC​(q)x\~¨θ​+Ff​+Fext​=0(76)  
其中 x\~θ:=xψ−xθ​。第二个辅助变量 xψ​ 从如下设计的虚拟动力学中获得。

KθC​(q)(xψ​−xd​)+DθC​(q)(x˙ψ​−x˙d​)=MC​(q)x¨d​+CC​(q,q˙​)x˙d​(77)  
为了实现闭环动力学 (76)，笛卡尔阻抗控制输入是：

ui​=JT(q)\[KC​x\~+DC​x\~˙θ​+MC​(q)x¨d​+CC​(q,q˙​)x˙d​+BθC​(q)x¨ψ​+Fg​(q)\](78)  
**8.2.3. 初步力-阻抗控制器。** 对于柔性关节机器人，组合控制器是：

u=ui​+uf​(79)  
在随后的稳定性分析中，将变得明显，这个朴素的统一控制器需要进行重大修改才能保证无源性和稳定性。在此基础上，推导出了所提出的力与阻抗控制统一的概念。

**8.3. 稳定性分析**

**8.3.1. 无源性分析。** 考虑闭环动力学 (76)，提出的存储函数是：

Sf​=21​(x\~θ​−x\~)TKθC​(q)(x\~θ​−x\~)+21​x\~˙θT​BθC​(q)x\~˙θ​+21​(xθ​−x)TKθC​(q)(xθ​−x)+21​x\~˙TMC​(q)x\~˙+21​x\~TKC​x\~(80)  
尽管它有一个负二次项，但它是一个适当的存储函数，遵循与 Ott et al. (2004) 相同的论证。假设 J˙(q)≈0， KθC​(q) 和 BθC​(q) 可以被认为是局部常数，即 KθC​(q)≈BθC​(q)≈0。因此，存储函数 Sf​ 的时间导数变为：

S˙f​=(x\~˙θ​−x\~˙)TKθC​(q)(x\~θ​−x\~)+x\~˙θT​BθC​(q)x\~¨θ​+(x˙θ​−x˙)TKθC​(q)(xθ​−x)+x\~˙TMC​(q)x\~¨+21​x\~˙TM˙C​(q)x\~˙+x\~˙TKC​x\~(81)  
如第 8.4 节所示，(81) 结果为：

S˙f​=x˙TFext​+x˙TFf​−x˙dT​(Ff​+Fext​)−x\~˙θT​DC​x\~˙θ​−(x\~˙θ​−x\~˙)TDθC​(q)(x\~˙θ​−x\~˙)(82)  
由于力控制器对应的功率特性未知——(x˙,Ff​)——以及与环境接触的阻抗控制端口——(x˙d,−Fext)——以及与力控制器交互的端口——(x˙d​,−Ff​)——无法保证相对于 (x˙,Fext​) 对的无源性。

**8.3.2. 能量箱增强。** 两种能量箱增强都类似于刚体的情况（参见第 4.2 节和第 4.3 节）。虽然力控制输入采用与 (27) 相同的形式，但阻抗控制器输入变为：

ui′​=JT(q)\[KC​x\~′+DC​x\~˙′+MC​(q)x¨d′​+CC​(q,q˙​)x˙d′​+BθC​(q)x¨ψ′​\]+g(q)(83)  
其中 x\~′=xd′​−x。此外，类似地， xψ′​ 可以通过求解以下方程获得：

KθC​(q)(xψ′​−xd′​)+DθC​(q)(x˙ψ′​−x˙d′​)=MC​(q)x¨d′​+CC​(q,q˙​)x˙d′​(84)  
最后，请注意 (29) 是为刚体机器人编写的。对于柔性关节机器人，项 x\~˙′TDC​x\~˙′ 应替换为 (x\~˙θ′TDC​x\~˙θ′+(x\~˙θ′−x\~˙′)TDθC(q)(x\~˙θ′​−x\~˙′))。

最后，根据 (27) 和 (83)，UFIC（参见图 17）为：

u′=ui′​+uf′​(85)  
**8.3.3. 能量箱增强后的无源性分析。** 考虑 (82) 并遵循与上述相同的方法，可以证明整体存储函数及其时间导数的半负性，如下所示。

Stot,f​:=Sf​+T(86)S˙tot,f​=x˙TFext​−x\~˙TDC​x\~˙−(x\~˙θ​−x\~˙)TDθC​(q)(x\~˙θ​−x\~˙)+x˙TFf′​−x˙d′T​(Ff′​+Fext​)−βf​γf​x˙TFf​+αf​(γf​−1)x˙TFf​+βi​γi​x˙dT​(Ff′​+Fext​)+x\~˙TDC​x\~˙+(x\~˙θ​−x\~˙)TDθC​(q)(x\~˙θ​−x\~˙)+αi​(1−γi​)x˙dT​(Ff′​+Fext​)(87)  
遵循与表 2 相同的推理，可以证明以下公式始终成立。

S˙tot,f​≤0(88)  
**8.4. 柔性关节机器人与 UFIC 的能量动力学**

与闭环动力学 (76) 对应的能量动力学方程表示为：

x\~˙θT​\[MC​(q)x\~¨+CC​(q,q˙​)x\~˙+KC​x\~+DC​x\~˙θ​+BθC​(q)x\~¨θ​+Ff​+Fext​−Fg​(q)+Fg​(q)\]=0(89)  
等效地，考虑 (75) 和 (77) 导致：

x\~˙θT​(KθC​(q)(xψ​−xd​)+DθC​(q)(x˙ψ​−x˙d​)MC​(q)x¨d​+CC​(q,q˙​)x˙d​​​)−x\~˙θT​(KθC​(q)(xθ​−x)+DθC​(q)(x˙θ​−x˙)MC​(q)x¨+CC​(q,q˙​)x˙+Fg​(q)−Fext​​​)+x\~˙θT​\[KC​x\~+DC​x\~˙θ​+BθC​(q)x\~¨θ​+Ff​+Fg​(q)\]=0(90)  
因此，得到：

x\~˙θT​\[KθC​(q)(x\~θ​−x\~)+DθC​(q)(x\~˙θ​−x\~˙)\]+x\~˙θT​\[KC​x\~+DC​x\~˙θ​+BθC​(q)x\~¨θ​+Ff​+Fg​(q)\]=0(91)  
等价地，这可以展开为：

(x\~˙θ​−x\~˙)TKθC​(q)(x\~θ​−x\~)+(x\~˙θ​−x\~˙)TDθC​(q)(x\~˙θ​−x\~˙)+x\~˙TMC​(q)x¨d​+CC​(q,q˙​)x˙d​\[KθC​(q)(xψ​−xd​)+DθC​(q)(x˙ψ​−x˙d​)\]​​−x\~˙TMC​(q)x¨+CC​(q,q˙​)x˙+Fg​(q)−Fext​\[KθC​(q)(xθ​−x)+DθC​(q)(x˙θ​−x˙)\]​​+x\~˙θT​\[KC​x\~+DC​x\~˙θ​+BθC​(q)x\~¨θ​+Ff​+Fg​(q)\]=0(92)  
重新排列后，可以看出：

(x\~˙θ​−x\~˙)TKθC​(q)(x\~θ​−x\~)+x\~˙TMC​(q)x\~¨+x\~˙TCC​(q,q˙​)x\~˙−x\~˙TFg​(q)+x\~˙θT​BθC​(q)x\~¨θ​+x\~˙θT​\[KC​x\~+Ff​+Fg​(q)\]=x\~˙TFext​−(x\~˙θ​−x\~˙)TDθC​(q)(x\~˙θ​−x\~˙)−x\~˙θT​DC​x\~˙θ​(93)  
如第 8.5 节所示，在准静态情况下，可以说：

x\~˙θT​\[KC​x\~+Ff​+Fg​(q)\]≈x\~˙T\[KC​x\~+Ff​+Fg​(q)\]−(x˙θ​−x˙)TKθC​(q)(xθ​−x)(95)  
因此，(94) 可以替换为：

**8.4.1. 备注。** 请注意，除了考虑近似 (95) 中使用的准静态情况外，还可以进行以下替换：

x\~˙θT​\[KC​x\~+Ff​+Fg​(q)\]=x\~˙T\[KC​x\~+Ff​+Fg​(q)\](97)  
通过增加一个额外的虚拟能量箱 Tadd​ 来补偿可能违反无源性的功率：

x\~˙θT​\[KC​x\~+Ff​+Fg​(q)\](98)  
在这种情况下，建议的存储函数 Sf​ 将是：

Sf​=21​(x\~θ​−x\~)TKθC​(q)(x\~θ​−x\~)+21​x\~˙θT​BθC​(q)x\~˙θ​+21​x\~˙TMC​(q)x\~˙+21​x\~TKC​x\~+Tadd​(99)  
**8.5. 柔性关节机器人与 UFIC 在准静态模式下**

考虑 (63)–(65) 和 (78)–(79)，对于准静态情况（即当 θ˙≈q˙​≈x˙ψ​≈x˙d​≈0）可以推导出以下内容：

KθC​(q)(xθ​−x)≈KC​x\~+Ff​+Fg​(q)(100)  
另一方面，(77) 变为：

KθC​(q)(xψ​−xd​)≈0⟹xψ​≈xd​(101)  
因此，在准静态情况下，可以写出：

x\~˙θT​\[KC​x\~+Ff​+Fg​(q)\]=x˙ψT​≈x˙dT​\[KC​x\~+Ff​+Fg​(q)\]​​−x˙θT​\[KC​x\~+Ff​+Fg​(q)\]≈x˙dT​\[KC​x\~+Ff​+Fg​(q)\]−x˙θT​KθC​(q)(xθ​−x)=x˙dT​\[KC​x\~+Ff​+Fg​(q)\]−(x˙θ​−x˙)TKθC​(q)(xθ​−x)+x˙TKθC​(q)(xθ​−x)≈x\~˙T\[KC​x\~+Ff​+Fg​(q)\]−(x˙θ​−x˙)TKθC​(q)(xθ​−x)(102)  
图 17\. 柔性关节机器人闭环 UFIC 系统的基于端口表示。