# ACTåˆ†å¸ƒå¼æ¨ç†ç³»ç»Ÿ

åŸºäºè®­ç»ƒå¥½çš„Frankaå•è‡‚ACTæ¨¡å‹çš„åˆ†å¸ƒå¼æ¨ç†æ¶æ„ï¼Œä½¿ç”¨agentlaceåè®®å®ç°å®¢æˆ·ç«¯-æœåŠ¡å™¨é€šä¿¡ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    agentlace     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯        â”‚    Protocol      â”‚   æ¨ç†æœåŠ¡å™¨    â”‚
â”‚   (ä»¿çœŸç¯å¢ƒ)    â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚   (GPUæœåŠ¡å™¨)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                                       â”‚
      â”œâ”€ æœºå™¨äººçŠ¶æ€ (8ç»´)                     â”œâ”€ ACTæ¨¡å‹ (83.91Må‚æ•°)
      â”œâ”€ ç›¸æœºå›¾åƒ (480Ã—640Ã—3)                â”œâ”€ CUDAæ¨ç†åŠ é€Ÿ
      â””â”€ å®æ—¶æ§åˆ¶ (50Hz)                     â””â”€ åŠ¨ä½œåºåˆ— (100æ­¥Ã—8ç»´)
```

## ğŸ“ ç›®å½•ç»“æ„

```
robot_server/
â”œâ”€â”€ inference/                    # æ¨ç†æ¨¡å—
â”‚   â””â”€â”€ act_inference.py         # ACTæ¨ç†å¼•æ“
â”œâ”€â”€ communication/               # é€šä¿¡æ¨¡å—  
â”‚   â”œâ”€â”€ act_server.py           # agentlaceæ¨ç†æœåŠ¡å™¨
â”‚   â””â”€â”€ act_client.py           # å®¢æˆ·ç«¯ç¤ºä¾‹
â”œâ”€â”€ start_inference_server.sh  # æœåŠ¡å™¨å¯åŠ¨è„šæœ¬
â””â”€â”€ README_INFERENCE.md        # æœ¬æ–‡æ¡£

../communication/
â”œâ”€â”€ act_protocol.py            # é€šä¿¡åè®®å®šä¹‰
â”œâ”€â”€ agentlace/                # agentlaceé€šä¿¡åº“
â””â”€â”€ robot_config.yaml        # é…ç½®æ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨æ¨ç†æœåŠ¡å™¨

```bash
# è¿›å…¥æœåŠ¡å™¨ç›®å½•
cd robot_server/

# å¯åŠ¨æœåŠ¡å™¨ï¼ˆé»˜è®¤ç«¯å£5555ï¼‰
./start_inference_server.sh

# æŒ‡å®šç«¯å£å¯åŠ¨
./start_inference_server.sh --port 5556

# æµ‹è¯•æ¨¡å¼
./start_inference_server.sh --test
```

### 2. å®¢æˆ·ç«¯è¿æ¥æµ‹è¯•

```bash
# æµ‹è¯•å®¢æˆ·ç«¯è¿æ¥
cd robot_server/communication/
python act_client.py
```

### 3. éªŒè¯æ¨ç†åŠŸèƒ½

```bash
# æµ‹è¯•æ¨ç†å¼•æ“
python inference/act_inference.py
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç½‘ç»œé…ç½®
- **æœåŠ¡å™¨IP**: 10.16.49.124 (å±€åŸŸç½‘)
- **é»˜è®¤ç«¯å£**: 5555 (agentlace)
- **é€šä¿¡åè®®**: ZMQ REQ-REP
- **ç½‘ç»œå»¶è¿Ÿ**: <111ms (å±€åŸŸç½‘)

### æ¨¡å‹é…ç½®
- **æ¨¡å‹ç±»å‹**: ACT Transformer
- **å‚æ•°æ•°é‡**: 83.91M
- **è¾“å…¥ç»´åº¦**: qpos(8) + image(480Ã—640Ã—3)
- **è¾“å‡ºç»´åº¦**: actions(100Ã—8)
- **æ¨ç†æ—¶é—´**: ~10ms (CUDA)

### æ•°æ®æ ¼å¼
- **çŠ¶æ€**: 8ç»´ (7å…³èŠ‚ + 1å¤¹çˆª)
- **å›¾åƒ**: 480Ã—640Ã—3 RGB
- **åŠ¨ä½œ**: 100æ­¥Ã—8ç»´è¿ç»­åŠ¨ä½œ
- **é¢‘ç‡**: 50Hzæ§åˆ¶ï¼Œ0.5Hzæ¨ç†

## ğŸŒ é€šä¿¡åè®®

### æ¨ç†æ¥å£ (`act_predict`)

**è¯·æ±‚æ ¼å¼**:
```json
{
  "robot_state": {
    "qpos": [8ä¸ªå…³èŠ‚ä½ç½®],
    "qvel": [8ä¸ªå…³èŠ‚é€Ÿåº¦], 
    "timestamp": æ—¶é—´æˆ³
  },
  "camera_data": {
    "image": "base64ç¼–ç çš„JPEGå›¾åƒ",
    "timestamp": æ—¶é—´æˆ³
  },
  "request_id": "è¯·æ±‚ID"
}
```

**å“åº”æ ¼å¼**:
```json
{
  "actions": [[100æ­¥Ã—8ç»´åŠ¨ä½œåºåˆ—]],
  "success": true,
  "latency_ms": å»¶è¿Ÿæ—¶é—´,
  "request_id": "è¯·æ±‚ID"
}
```

### çŠ¶æ€æ¥å£ (`server_status`)

æŸ¥è¯¢æœåŠ¡å™¨çŠ¶æ€å’Œæ€§èƒ½ç»Ÿè®¡ã€‚

## ğŸ§ª æµ‹è¯•éªŒè¯

### æ¨ç†å¼•æ“æµ‹è¯•
```bash
python inference/act_inference.py
```

é¢„æœŸè¾“å‡ºï¼š
```
âœ… æ¨ç†æˆåŠŸ!
   è¾“å…¥: qpos(8,), image(480, 640, 3)
   è¾“å‡º: actions(100, 8)
   è€—æ—¶: ~10ms
   åŠ¨ä½œèŒƒå›´: [-0.5, 0.5]
```

### é€šä¿¡æµ‹è¯•
```bash
# ç»ˆç«¯1: å¯åŠ¨æœåŠ¡å™¨
./start_inference_server.sh

# ç»ˆç«¯2: æµ‹è¯•å®¢æˆ·ç«¯
python communication/act_client.py
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### æ¨ç†æ€§èƒ½
- **æ¨¡å‹åŠ è½½**: ~3ç§’
- **æ¨ç†å»¶è¿Ÿ**: 10-15ms (CUDA)
- **å†…å­˜ä½¿ç”¨**: ~2GB GPUå†…å­˜
- **ååé‡**: ~100 FPS

### ç½‘ç»œæ€§èƒ½
- **å¾€è¿”å»¶è¿Ÿ**: 46-111ms (å±€åŸŸç½‘)
- **æ•°æ®å‹ç¼©**: JPEG ~50-100KB/å¸§
- **æ€»ä½“å»¶è¿Ÿ**: <150ms (æ»¡è¶³2ç§’ç¼“å†²è¦æ±‚)

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ¨¡å‹åŠ è½½å¤±è´¥**
   ```bash
   # æ£€æŸ¥æ¨¡å‹æ–‡ä»¶
   ls -la /home/wujielin/CascadeProjects/data/act_training/checkpoints/franka_pick_place/
   
   # éªŒè¯ç¯å¢ƒ
   conda activate aloha
   python -c "import torch; print(torch.cuda.is_available())"
   ```

2. **ç½‘ç»œè¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥ç«¯å£
   netstat -an | grep 5555
   
   # æµ‹è¯•è¿æ¥
   telnet 10.16.49.124 5555
   ```

3. **æ¨ç†é”™è¯¯**
   ```bash
   # æ£€æŸ¥è¾“å…¥æ ¼å¼
   python communication/act_client.py
   ```

### æ—¥å¿—è°ƒè¯•
- æœåŠ¡å™¨æ—¥å¿—ï¼šç»ˆç«¯ç›´æ¥è¾“å‡º
- è¯¦ç»†é”™è¯¯ï¼šPython traceback
- æ€§èƒ½ç»Ÿè®¡ï¼š`server_status`æ¥å£

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### Pythonå®¢æˆ·ç«¯é›†æˆ
```python
from act_client import ACTClient
import numpy as np

# è¿æ¥æœåŠ¡å™¨
client = ACTClient("10.16.49.124", 5555)

# æ¨ç†å¾ªç¯
for step in range(1000):
    # è·å–æœºå™¨äººçŠ¶æ€å’Œå›¾åƒ
    qpos = get_robot_state()  # (8,)
    image = get_camera_image()  # (480, 640, 3)
    
    # è¯·æ±‚åŠ¨ä½œåºåˆ—
    actions = client.predict(qpos, image)  # (100, 8)
    
    # æ‰§è¡ŒåŠ¨ä½œ
    for action in actions:
        robot.step(action)
        time.sleep(0.02)  # 50Hz
```

## ğŸ“ˆ æ‰©å±•åŠŸèƒ½

1. **å¤šå®¢æˆ·ç«¯æ”¯æŒ**: agentlaceå¤©ç„¶æ”¯æŒå¤šå®¢æˆ·ç«¯
2. **è´Ÿè½½å‡è¡¡**: å¯éƒ¨ç½²å¤šä¸ªæ¨ç†æœåŠ¡å™¨
3. **æ¨¡å‹çƒ­æ›´æ–°**: æ”¯æŒä¸åœæœºæ›´æ–°æ¨¡å‹
4. **ç›‘æ§é¢æ¿**: åŸºäºçŠ¶æ€æ¥å£çš„å¯è§†åŒ–ç›‘æ§

---

**ğŸ‰ åˆ†å¸ƒå¼ACTæ¨ç†ç³»ç»Ÿå·²å°±ç»ªï¼**

*ç‰ˆæœ¬: v1.0 | æ›´æ–°: 2025-09-20*
